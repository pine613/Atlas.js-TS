/**
 * Atlas.js v0.7.0
 * https://github.com/steelydylan/Atlas.js
 * Copyright steelydylan
 * <http://steelydylan.webcrow.jp/>
 * Released under the MIT license.
 */
!function(){"use strict";var t=[],e=[],i=[],s=0,h=function(){var t=navigator.userAgent;return t.indexOf("iPhone")>0&&-1==t.indexOf("iPad")||t.indexOf("iPod")>0||t.indexOf("Android")>0?!0:!1}(),n=function(){var t=window.matchMedia("(orientation: portrait)");return t.matches?"portrait":"landscape"}(),r=function(t,e,i){var s=i.which;switch(s){case 13:t.enter=!0,e.enter=!0;break;case 16:t.shift=!0,e.shift=!0;break;case 32:t.space=!0,e.space=!0;break;case 39:t.right=!0,e.right=!0;break;case 37:t.left=!0,e.left=!0;break;case 38:t.up=!0,e.up=!0;break;case 40:t.down=!0,e.down=!0;break;case 8:t.backspace=!0,e.backspace=!0}for(var h=0;26>h;h++)if(h+65==s){var n=String.fromCharCode(h+97);t[n]=!0,e[n]=!0;break}},a=function(t){t.enter=!1,t.shift=!1,t.space=!1,t.right=!1,t.left=!1,t.up=!1,t.down=!1,t.backspace=!1;for(var e=0;26>e;e++)t[String.fromCharCode(e+97)]=!1},o=function(){var t=new Object;return a(t),t}(),c=function(){for(var t in c)window[t]=c[t]};c.createClass=function(t,e){var i=function(){this.initialize.apply(this,arguments)};"function"==typeof t&&"object"==typeof e?(i.prototype=Object.create(t.prototype),i.prototype.inherit=function(){this.initialize=this.superClass.prototype.initialize,this.superClass=this.superClass.prototype.superClass,this.initialize&&this.initialize.apply(this,arguments)}):"object"==typeof t&&null==e&&(e=t);for(var s in e)i.prototype[s]=e[s];return i.prototype.superClass=t,i},c.extendClass=function(t,e){for(var i in e)t.prototype[i]=e[i]};var l=function(t,e,i){var s=t.mover,h=s[s.length-1];if(h&&h.and)var n=h;else{var n=new Object;s.push(n)}return n.time=0,i&&(n.frame=i),n.loop=!1,n.and=!1,n[e]=!0,n},u=c.createClass({isMobile:h,orientation:n,initialize:function(){this.eventListener=new Object,this.mover=[],this.rot=0,this.moverIndex=0,this.visible=!0,this.eventEnable=!0,this.drawMode="source-over";var t=this.eventListener;t.touchStart=!1,t.touchMove=!1,t.touchEnd=!1,t.keyUp=!1,t.keyDown=!1,t.multiTouchStart=!1,t.multiTouchMove=!1,t.multiTouchEnd=!1,t.orientationChange=!1},tween:function(){var t=this.mover,e=t.length;if(this.moverIndex<e){var i=t[this.moverIndex];i.animate&&this._animate(i),i.moveTo&&this._moveTo(i),i.moveBy&&this._moveBy(i),i.rotateBy&&this._rotateBy(i),i.scaleBy&&this._scaleBy(i),i.then&&this._then(i),i.time++,i.time>i.frame&&(this.moverIndex++,this.moverIndex==e&&(i.loop?this._refresh():this.stop()))}},isQueEmpty:function(){return this.mover.length?!1:!0},_refresh:function(){this.moverIndex=0;for(var t=this.mover,e=0,i=t.length;i>e;e++){var s=t[e];s.time&&(s.time=0)}},moveTo:function(t,e,i){var s=l(this,"moveTo",i);return s.toX=t,s.toY=e,this},_moveTo:function(t){0==t.time&&(t.diffX=t.toX-this.x,t.diffY=t.toY-this.y),this.x=t.toX-t.diffX*(1-t.time/t.frame),this.y=t.toY-t.diffY*(1-t.time/t.frame)},moveBy:function(t,e,i){var s=l(this,"moveBy",i);return s.diffX=t,s.diffY=e,this},_moveBy:function(t){0==t.time&&(t.toX=this.x+t.diffX,t.toY=this.y+t.diffY),this.x=t.toX-t.diffX*(1-t.time/t.frame),this.y=t.toY-t.diffY*(1-t.time/t.frame)},delay:function(t){var e=l(this,"delay",t);return this.mover.push(e),this},and:function(){var t=this.mover,e=t[t.length-1];return e&&(e.and=!0),this},stop:function(){return this.mover=[],this.moverIndex=0,this},loop:function(){var t=this.mover[this.mover.length-1];return t.loop=!0,this},rotateBy:function(t,e){var i=l(this,"rotateBy",e);return i.diffAngle=t,this},_rotateBy:function(t){0==t.time&&(t.toAngle=this.rot+t.diffAngle),this.rot=t.toAngle-t.diffAngle*(1-t.time/t.frame)},then:function(t,e){var i=l(this,"then",e);return i.exec=t,this},_then:function(t){t.exec.call(this)},scaleBy:function(t,e,i){var s=l(this,"scaleBy",i);return s.scaleX=t,s.scaleY=e,this},setPosition:function(t,e){return this.x=t,this.y=e,this},saveData:function(t){var e=new Object;for(var i in this)"function"!=typeof this[i]&&(e[i]=this[i]);localStorage.setItem(t,JSON.stringify(e))},getData:function(t){var e=JSON.parse(localStorage.getItem(t));for(var i in e)this[i]=e[i]},getTouchPosition:function(t,e){e&&t.touches[e]||(e=0);var i=this.field,s=parseInt(i.width)/parseInt(i.style.width),n=parseInt(i.height)/parseInt(i.style.height),r=new Object,a=i.getBoundingClientRect(),o=parseInt(a.left),c=parseInt(a.top);isNaN(o)&&(o=0),isNaN(c)&&(c=0);var l=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop;return t?!h||h&&t.touches[e]?(r.x=(h?t.touches[e].pageX:t.pageX)-o-l,r.y=(h?t.touches[e].pageY:t.pageY)-c-u):(r.x=-1,r.y=-1):(r.x=event.x-o,r.y=event.y-c),r.x=parseInt(r.x*s),r.y=parseInt(r.y*n),r},getMultiTouchPosition:function(t){for(var e=t.touches.length,i=[],s=0;e>s;s++)i[s]=this.getTouchPosition(t,s);return i},handleEvent:function(t){if(this.eventEnable){t.preventDefault();var e=this.getTouchPosition(t);e.touchCount=t.touches?t.touches.length:1,e.event=t;var i=t.type;if("keydown"==i||"keyup"==i){var s=new Object;for(var h in o)s[h]=o[h];r(s,o,t)}switch(i){case"touchstart":this.multiTouchStart&&t.touches.length>1?this.multiTouchStart(this.getMultiTouchPosition(t)):this.touchStart&&this.touchStart(e);break;case"mousedown":this.touchStart&&this.touchStart(e);break;case"touchmove":this.multiTouchMove&&t.touches.length>1?this.multiTouchMove(this.getMultiTouchPosition(t)):this.touchMove&&this.touchMove(e);break;case"mousemove":this.touchMove&&this.touchMove(e);break;case"touchend":this.multiTouchEnd&&t.touches.length>1?this.multiTouchEnd(this.getMultiTouchPosition(t)):this.touchEnd&&this.touchEnd(e);break;case"mouseup":this.touchEnd&&this.touchEnd();break;case"keydown":this.keyDown&&this.keyDown(o);break;case"keyup":this.keyUp&&this.keyUp(s)}}},useEvent:function(){var t=this.field,e=this.eventListener;this.touchStart&&0==e.touchStart&&(h?t.addEventListener("touchstart",this,!1):t.addEventListener("mousedown",this,!1),e.touchStart=!0),this.touchMove&&0==e.touchMove&&(h?t.addEventListener("touchmove",this,!1):t.addEventListener("mousemove",this,!1),e.touchMove=!0),this.touchEnd&&0==e.touchEnd&&(h?t.addEventListener("touchend",this,!1):t.addEventListener("mouseup",this,!1),e.touchEnd=!0),this.multiTouchStart&&0==e.multiTouchStart&&(e.touchStart||(h?t.addEventListener("touchstart",this,!1):t.addEventListener("mousedown",this,!1)),e.touchStart=!0),this.multiTouchMove&&0==e.multiTouchMove&&(e.touchMove||(h?t.addEventListener("touchmove",this,!1):t.addEventListener("mousemove",this,!1)),e.touchMove=!0),this.multiTouchEnd&&0==e.multiTouchEnd&&(e.touchEnd||(h?t.addEventListener("touchend",this,!1):t.addEventListener("mouseup",this,!1)),e.touchEnd=!0),this.keyUp&&0==e.keyUp&&(t.addEventListener("keyup",this,!1),e.keyUp=!0),this.keyDown&&0==e.keyDown&&(t.addEventListener("keydown",this,!1),e.keyDown=!0)},remove:function(){this._remove=!0},getRand:function(t,e){return~~(Math.random()*(e-t+1))+t},HSBtoRGB:function(t,e,i){var s,h,n,r,a,o,c,l;switch(h=Math.floor(t/60)%6,s=t/60-Math.floor(t/60),n=Math.round(i*(1-e/255)),r=Math.round(i*(1-e/255*s)),a=Math.round(i*(1-e/255*(1-s))),h){case 0:o=i,c=a,l=n;break;case 1:o=r,c=i,l=n;break;case 2:o=n,c=i,l=a;break;case 3:o=n,c=r,l=i;break;case 4:o=a,c=n,l=i;break;case 5:o=i,c=n,l=r}return o=15>=o?"0"+o.toString(16):o.toString(16),c=15>=c?"0"+c.toString(16):c.toString(16),l=15>=l?"0"+l.toString(16):l.toString(16),"#"+o+c+l},getSound:function(t){for(var i=0,s=e.length;s>i;i++)t==e[i].name&&(this.sound=new Audio(e[i].src))},soundClonePlay:function(){var t=this.sound;t&&new Audio(t.src).play()},soundLoopPlay:function(){var t=this.sound;t&&(t.loop||t.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),t.loop=!0,t.play())},soundReplay:function(){var t=this.sound;t&&(t.load(),t.play())},soundStop:function(){var t=this.sound;t.paused?t.load():(t.pause(),t.currentTime=0)},soundPlay:function(){var t=this.sound;t&&t.play()},soundPause:function(){var t=this.sound;t&&t.pause()},soundGetCount:function(){var t=this.sound;return t?t.currentTime:void 0},soundSetCount:function(t){var e=this.sound;e&&(e.currentTime=t)},soundGetVolume:function(){var t=this.sound;return t?t.volume:void 0},soundSetVolume:function(t){var e=this.sound;e&&(e.volume=t)},soundGetAlltime:function(){var t=this.sound;return t?t.duration:void 0},soundIsPlaying:function(){var t=this.sound;return t?!t.paused:void 0}}),d=c.createClass(Array,{initialize:function(){this.inherit(),this._basicConstructor="Scene",this._remove=!1},addChild:function(t){if(t.parent=this,t.children)for(var e=t.children,i=0,s=e.length;s>i;i++){var h=e[i];h.ctx=this.ctx,h.field=this.field}this.ctx&&this.field&&(t.ctx=this.ctx,t.field=this.field),this.push(t)},addChildren:function(){for(var t=0,e=arguments.length;e>t;t++)this.addChild(arguments[t])},getChild:function(t){var e=this.getChildren(t),i=e[0];return i||(i=null),i},getChildren:function(t){for(var e=[],i=0,s=this.length;s>i;i++){var h=!0;for(var n in t)t[n]!=this[i][n]&&(h=!1);1==h&&e.push(this[i])}return e},remove:function(){this._remove=!0},setImage:function(t){this.image=t},setColor:function(t){this.color=t},_enterFrame:function(){this.enterFrame&&this.enterFrame();for(var t=0,e=this.length;e>t;t++){var i=this[t];if("Sprite"==i._basicConstructor&&!i.spriteWidth){var s=i.getImageSize();s.width&&(i.setSpriteSize(s.width,s.height),i.width||(i.setSize(s.width,s.height),i._scaleX&&i.scale(i._scaleX,i._scaleY)))}i.useEvent&&i.useEvent(),i.enterFrame&&i.enterFrame(),i.tween&&i.tween(),i.visible&&(i.preDraw&&i.preDraw(),i.draw()),i._remove&&(this.splice(t,1),i=null,t--,e--)}}}),f=c.createClass(u,{initialize:function(t){this.inherit(),this._basicConstructor="App";var e=document.createElement("style");e.media="screen",e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e);var i;if(t)i=document.getElementById(t);else{i=document.createElement("canvas");var s=document.getElementsByTagName("body").item(0);s.appendChild(i)}i.width=320,i.height=480,i.style.top="0px",i.style.left="0px",i.tabIndex="1",document.body.style.margin="0em";navigator.userAgent;h?(i.style.width=window.innerWidth+"px",i.style.height=window.innerHeight+"px",i.addEventListener("touchstart",function(){this.focus()})):(i.style.width="480px",i.style.height="620px",i.addEventListener("mousedown",function(){this.focus()}),i.addEventListener("keyup",function(){a(o)},!1)),this._css=e,this.field=i,this.ctx=i.getContext("2d"),this.fps=30,this.scene=new d,this.scene.ctx=this.ctx,this.scene.field=this.field,this.scene.parent=this},getCanvasURL:function(){return this.field.toDataURL()},getCanvasImage:function(){var t=this.field.toDataURL();window.open(t,"_blank")},colorToAlpha:function(e,i){for(var s,h=0,n=t.length;n>h;h++)t[h].name==e&&(s=t[h],s.hex=i,s.index=h);s.addEventListener("load",function(){var e=document.createElement("canvas"),i=e.getContext("2d"),s=this.width,h=this.height,n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,r=this.hex.replace(n,function(t,e,i,s){return e+e+i+i+s+s}),a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r),o=a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null;i.drawImage(this,0,0);for(var c=i.getImageData(0,0,s,h),l=c.data,u=0;h>u;u++)for(var d=0;s>d;d++){var f=4*u*s+4*d;l[f]==o.r&&l[f+1]==o.g&&l[f+2]==o.b&&(l[f+3]=0)}i.putImageData(c,0,0);var v=new Image;v.src=e.toDataURL(),t[this.index]=v})},addChild:function(t){t.ctx=this.ctx,t.field=this.field,this.scene.addChild(t)},addChildren:function(){for(var t=0,e=arguments.length;e>t;t++)this.addChild(arguments[t])},centerize:function(){var t=this.field.style;t.marginTop=-parseInt(t.height)/2+"px",t.marginLeft=-parseInt(t.width)/2+"px",t.top="50%",t.left="50%",t.position="absolute"},fitWindow:function(){this.setSize(window.innerWidth,window.innerHeight);var t=this;window.onresize=function(){t.setSize(window.innerWidth,window.innerHeight)}},setQuality:function(t,e){var i=this.field;i.width=t,i.height=e},setSize:function(t,e){var i=this.field.style;i.width=t+"px",i.height=e+"px"},getSize:function(){var t=new Object;return t.width=parseInt(this.field.style.width),t.height=parseInt(this.field.style.height),t},getQuality:function(){var t=new Object;return t.width=parseInt(this.field.width),t.height=parseInt(this.field.height),t},loadingScene:function(t){this.preScene=t,this.preScene.parent=this},_preLoadEnterFrame:function(){var t=this.field;this.useEvent();var e=this.ctx;if(e.clearRect(0,0,t.width,t.height),s>0&&this.preScene)this.preScene._enterFrame();else{this.onLoad&&this.onLoad();for(var i=this.scene,h=0,n=i.length;n>h;h++){var r=i[h];r._onLoad&&r._onLoad(),r.onLoad&&r.onLoad()}clearInterval(this.preLoadInterval);var a=this;setInterval(function(){a._enterFrame()},1e3/this.fps)}},_enterFrame:function(){var t=this.field;this.ctx.clearRect(0,0,t.width,t.height),this.useEvent(),this.enterFrame&&this.enterFrame(),this.scene._enterFrame()},pushScene:function(t){for(var e=this.ctx,i=this.field,s=this.scene,h=0,n=s.length;n>h;h++){var r=s[h];r.eventEnable=!1,r.onSceneremoved&&r.onSceneRemoved()}for(var h=0,n=t.length;n>h;h++){var a=t[h];a.ctx=e,a.field=i,a.eventEnable=!0,a.onScenePushed&&a.onScenePushed()}t.parent=this,t.ctx=e,t.field=i;var o=this.field.style;o.background=null,o.backgroundColor="white",t.color&&this.setColor(t.color),t.image&&this.setImage(t.image),this.scene=t},setColor:function(t){var e=this.field.style;e.background=null,e.backgroundColor=t},setImage:function(t){var e=this.field.style;e.background="url("+t+") no-repeat center",e.backgroundSize="cover"},start:function(){var t=this.field,e=this;this.ctx.clearRect(0,0,t.width,t.height),this.preLoadInterval=setInterval(function(){e._preLoadEnterFrame()},1e3/this.fps)},toDataURL:function(){return this.field.toDataURL()},load:function(){function h(t){var e;if(!t)return e;var i=t.split("."),s=i.length;return 0===s?e:e=i[s-1]}for(var n=0,r=arguments.length;r>n;n++){var a=arguments[n];if(a instanceof Array)var o=a[0],c=a[1];else var o=a,c=a;var l=h(o);if("wav"==l||"mp3"==l||"ogg"==l){var a=new Audio(o);a.name=c,s++,a.addEventListener("canplaythrough",function(){s--,console.log(this.src+" is loaded")}),e.push(a)}else if("TTF"==l||"ttf"==l){var u=this._css,d=document.createTextNode("@font-face{font-family:'"+c+"';src: url('"+o+"') format('truetype');}");u.styleSheet?u.styleSheet.cssText=d:u.appendChild(d)}else if("svg"==l){var a=document.createElement("object");a.addEventListener("load",function(){s--,this.style.display="none",console.log(this.data+" is loaded")}),a.data=o,a.name=c,document.body.appendChild(a),s++,i.push(a)}else if("png"==l||"gif"==l||"jpeg"==l||"jpg"==l){var a=new Image;a.addEventListener("load",function(){s--,console.log(this.src+" is loaded")}),a.src=o,a.name=c,s++,t.push(a)}}}}),v=c.createClass(u,{initialize:function(t,e){this.inherit(),this.x=0,this.y=0,this._remove=!1,this.width=t,this.height=e,this.collisionShape="box",this.alpha=1,this.field},_scaleBy:function(t){0==t.time&&(t.toWidth=this.width*t.scaleX,t.toHeight=this.height*t.scaleY,t.diffWidth=t.toWidth-this.width,t.diffHeight=t.toHeight-this.height),this.width=t.toWidth-t.diffWidth*(1-t.time/t.frame),this.height=t.toHeight-t.diffHeight*(1-t.time/t.frame)},intersect:function(t,e){var i=this.x,s=this.y;if("Group"==this.parent.className&&(i+=this.parent.x,s+=this.parent.y),"box"==this.collisionShape){var h=t-(i+this.width/2),n=e-(s+this.height/2),r=this.rot,a=Math.sin(-r),o=Math.cos(-r),c=Math.abs(h*o-n*a),l=Math.abs(h*a+n*o);return c<this.width/2&&l<this.height/2?!0:!1}if("circle"==this.collisionShape){var u=this.width/2,h=t-(i+u),n=e-(s+u);return Math.sqrt(h*h+n*n)<u?!0:!1}return!1},hitTest:function(t){if("box"!=this.collisionShape)return"circle"==this.collisionShape?this.within(t,this.width/2):!1;if("circle"==t.collisionShape)return t.within(this,t.width/2);var e=this.x,i=this.y,s=this.width,h=this.height,n=e+this.width/2,r=i+this.height/2,a=t.x,o=t.y,c=t.width,l=t.height;if("Group"==this.parent._basicConstructor&&(e+=this.parent.x,i+=this.parent.y),0!=t.rot&&t.rot!=Math.PI&&"box"==t.collisionShape){var u=a+c/2,d=o+l/2,n=e+s/2,r=i+h/2,f=-t.rot;n=Math.cos(f)*(n-u)-Math.sin(f)*(r-d)+u,r=Math.sin(f)*(n-u)+Math.cos(f)*(r-d)+d,e=n-s/2,i=r-h/2}return a+c>e&&e+s>a&&o+l>i&&i+h>o},within:function(t,e){var i=this.x,s=this.y;if("Group"==this.parent._basicConstructor&&(i+=this.parent.x,s+=this.parent.y),"box"==this.collisionShape)var h=i+this.width/2,n=s+this.height/2;else{if("circle"!=this.collisionShape)return!1;var r=this.width/2,h=i+r,n=s+r}if("box"==t.collisionShape){var a,o,c=t.x+t.width/2,l=t.y+t.height/2,u=-t.rot,d=Math.cos(u)*(h-c)-Math.sin(u)*(n-l)+c,f=Math.sin(u)*(h-c)+Math.cos(u)*(n-l)+l;a=d<t.x?t.x:d>t.x+t.width?t.x+t.width:d,o=f<t.y?t.y:f>t.y+t.height?t.y+t.height:f;var v=Math.abs(d-a),p=Math.abs(f-o)}else{if("circle"!=t.collisionShape)return!1;var m=t.width/2,a=t.x+m,o=t.y+m,v=Math.abs(h-a),p=Math.abs(n-o);e+=m}return Math.sqrt(v*v+p*p)<e?!0:!1},scale:function(t,e){return this.width?(this.width*=t,this.height*=e):(this._scaleX=t,this._scaleY=e),this},setSize:function(t,e){this.width=t,this.height=e}}),p=c.createClass(v,{initialize:function(t,e,i){this.inherit(0,0),this.obj=-1,"object"==typeof t?this.path=t:"string"==typeof t&&this.setImage(t),this.closeMode=!0,this.color=e?e:"original",this.strokeColor=i?i:"original"},setImage:function(t){for(var e=0,s=i.length;s>e;e++)t==i[e].name&&(this.obj=e)},parsePath:function(t){var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},i=/([astvzqmhlc])([^astvzqmhlc]*)/gi,s=[];return t.replace(i,function(t,i,h){var n=i.toLowerCase();for(h=h.match(/-?[.0-9]+(?:e[-+]?\d+)?/gi),h=h?h.map(Number):[],"m"==n&&h.length>2&&(s.push([i].concat(h.splice(0,2))),n="l",i="m"==i?"l":"L");;){if(h.length==e[n]){if(h.unshift(i),"q"==h[0])var r={method:"quadraticCurveBy",cpx:h[1],cpy:h[2],x:h[3],y:h[4]};else if("Q"==h[0])var r={method:"quadraticCurveTo",cpx:h[1],cpy:h[2],x:h[3],y:h[4]};else if("l"==h[0])var r={method:"lineBy",x:h[1],y:h[2]};else if("L"==h[0])var r={method:"lineTo",x:h[1],y:h[2]};else if("m"==h[0])var r={method:"moveBy",x:h[1],y:h[2]};else if("M"==h[0])var r={method:"moveTo",x:h[1],y:h[2]};else if("c"==h[0])var r={method:"bezierCurveBy",cpx1:h[1],cpy1:h[2],cpx2:h[3],cpy2:h[4],x:h[5],y:h[6]};else if("C"==h[0])var r={method:"bezierCurveTo",cpx1:h[1],cpy1:h[2],cpx2:h[3],cpy2:h[4],x:h[5],y:h[6]};else if("h"==h[0])var r={method:"horizontalBy",x:h[1]};else if("H"==h[0])var r={method:"horizontalTo",x:h[1]};else if("v"==h[0])var r={method:"verticalBy",y:h[1]};else if("V"==h[0])var r={method:"verticalTo",y:h[1]};else if("s"==h[0])var r={method:"bezierCurveShortBy",cpx2:h[1],cpy2:h[2],x:h[3],y:h[4]};else if("S"==h[0])var r={method:"bezierCurveShortTo",cpx2:h[1],cpy2:h[2],x:h[3],y:h[4]};else if("t"==h[0])var r={method:"quadraticCurveShortBy",x:h[1],y:h[2]};else if("T"==h[0])var r={method:"quadraticCurveShortTo",x:h[1],y:h[2]};else var r={};return s.push(r)}s.push([i].concat(h.splice(0,e[n])))}}),s},_onLoad:function(){var t=i[this.obj].getSVGDocument(),e=t.getElementsByTagName("path")[0],s=t.getElementsByTagName("svg")[0],h=e.getAttribute("d");"original"==this.color&&(this.color=e.getAttribute("fill")),"original"==this.strokeColor&&this.strokeColor==e.getAttribute("stroke"),this.path=this.parsePath(h),this.spriteWidth=parseInt(s.getAttribute("width")),this.spriteHeight=parseInt(s.getAttribute("height")),console.log(this.width),this.width||(this.width=this.spriteWidth),this.height||(this.height=this.spriteHeight)},draw:function(){var t=this.path,e=this.ctx,i=0,s=0,h=0,n=0,r=0,a=0,o=this.width,c=this.height,l=o/this.spriteWidth,u=c/this.spriteHeight,d=o/2,f=c/2;e.globalAlpha=this.alpha,e.globalCompositeOperation=this.drawMode,e.save(),e.translate(this.x+d,this.y+f),e.rotate(this.rot),e.translate(-d,-f),e.scale(l,u),e.beginPath();for(var v=0,p=t.length;p>v;v++){var m=this.path[v],g=m.method;"moveTo"==g||"quadraticCurveTo"==g||"bezierCurveTo"==g||"lineTo"==g||"bezierCurveShortTo"==g||"quadraticCurveShortTo"==g?(h=0,n=0,i=m.x,s=m.y):(h=i,n=s,i+=m.x,s+=m.y),"moveTo"==g||"moveBy"==g?e.moveTo(i,s):"lineTo"==g||"lineBy"==g?e.lineTo(i,s):"quadraticCurveBy"==g||"quadraticCurveTo"==g?(e.quadraticCurveTo(h+m.cpx,n+m.cpy,i,s),r=2*i-(h+m.cpx),a=2*s-(n+m.cpy)):"bezierCurveTo"==g||"bezierCurveBy"==g?(e.bezierCurveTo(h+m.cpx1,n+m.cpy1,h+m.cpx2,n+m.cpy2,i,s),r=2*i-(h+m.cpx2),a=2*s-(n+m.cpy2)):"horizontalTo"==g||"horizontalBy"==g?e.lineTo(m.x,s):"verticalTo"==g||"verticalBy"==g?e.lineTo(i,m.y):"bezierCurveShortBy"==g||"bezierCurveShortTo"==g?(e.bezierCurveTo(r,a,h+m.cpx2,n+m.cpy2,i,s),r=2*i-(h+m.cpx2),a=2*s-(n+m.cpy2)):("quadraticCurveShortBy"==g||"quadraticCurveShortTo"==g)&&(e.quadraticCurveTo(r,a,i,s),r=2*i-r,a=2*s-a)}this.closeMode&&e.closePath(),e.fillStyle=this.color,e.fill(),e.strokeStyle=this.strokeColor,e.stroke(),e.restore()},getNodeByName:function(t){for(var e=this.path,i=0,s=e.length;s>i;i++){var h=e[i];if(t==h.name)return h}return-1}});p.Box=c.createClass(v,{initialize:function(t,e,i){this.inherit(e,i),this._basicConstructor="Shape",this.color=t},draw:function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode,t.beginPath(),t.fillStyle=this.color;var e=this.x+this.width/2,i=this.y+this.height/2;t.save(),t.translate(e,i),t.rotate(this.rot),t.translate(-e,-i),t.fillRect(this.x,this.y,this.width,this.height),t.restore(),t.globalAlpha=1}}),p.Circle=c.createClass(v,{initialize:function(t,e){this.inherit(2*e,0),this._basicConstructor="Shape",this.color=t,this.collisionShape="circle"},draw:function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode,t.beginPath(),t.fillStyle=this.color;var e=this.width/2;t.arc(this.x+e,this.y+e,e,0,2*Math.PI,!1),t.fill(),t.globalAlpha=1}});var m=c.createClass(v,{initialize:function(t,e,i){"undefined"==typeof e&&(e=null,i=null),this.inherit(e,i),this.setImage(t,e,i),this._basicConstructor="Sprite",this.frame=0,this.alpha=1},animate:function(t,e,i){var s=l(this,"animate",i);return s.array=t,s.frameRate=e,s.frameIdx=0,this},_animate:function(t){0==t.time&&(this.frame=t.array[0]),t.time%t.frameRate==0&&(t.frameIdx=(t.frameIdx+1)%t.array.length,this.frame=t.array[t.frameIdx])},setSpriteSize:function(t,e){this.spriteWidth=t,this.spriteHeight=e},setImage:function(e,i,s){i&&s&&this.setSpriteSize(i,s);for(var h=t.length,n=0;h>n;n++)t[n].name==e&&(this.img=n)},getImage:function(){return t[this.img]},getImageSize:function(){var e={},i=t[this.img];return e.width=i.width,e.height=i.height,e},draw:function(){var e=this.ctx;e.globalAlpha=this.alpha,e.globalCompositeOperation=this.drawMode;var i=this.frame,s=t[this.img],h=this.spriteWidth,n=this.spriteHeight,r=this.width/2,a=this.height/2,o=s.width/h,c=s.height/n,l=this.width/h,u=this.height/n,d=i%o*h,f=~~(i/o)%c*n;e.save(),e.translate(this.x+r,this.y+a),e.rotate(this.rot),e.translate(-r,-a),e.scale(l,u),null!=d&&e.drawImage(s,d,f,h,n,0,0,h,n),e.restore(),e.globalAlpha=1}}),g=c.createClass(m,{initialize:function(t,e,i){this.inherit(t,e,i),this.drawData,this.hitData},intersect:function(t,e){for(var i=this.hitData,s=i[0].length,h=i.length,n=this.width,r=this.height,a=this.x,o=this.y,c=0;h>c;c++)for(var l=0;s>l;l++)if(1==i[c][l]&&t>a+l*n&&a+(l+1)*n>t&&e>o+c*r&&o+(c+1)*r>e)return!0;return!1},draw:function(){var e=this.drawData,i=e[0].length,s=e.length,h=this.width,n=this.height,r=this.x,a=this.y,o=0,c=0,l=this.field,u=this.ctx;u.globalAlpha=this.alpha,u.globalCompositeOperation=this.drawMode;for(var d,f=l.height,v=l.width,p=t[this.img],m=this.spriteWidth,g=this.spriteHeight,y=(this.width/2,this.height/2,p.width/m),w=p.height/g,x=this.width/m,b=this.height/g,C=d%y*m,S=~~(d/y)%w*g;s>o;){for(;i>c;){if(d=e[o][c],d>=0&&f>a+n*o&&a+n*(o+1)>0&&v>r+h*c&&r+h*(c+1)>0){var C=d%y*m,S=~~(d/y)%w*g;u.save(),u.translate(this.x,this.y),u.scale(x,b),u.drawImage(p,C,S,m,g,0,0,m,g),u.restore()}this.x+=h,c++}this.y+=n,o++,this.x=r,c=0}this.x=r,this.y=a}}),y=c.createClass(u,{initialize:function(t,e,i,s){this.inherit(),this._basicConstructor="Text",this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.spaceWidth=7,this.font=s?"'"+s+"'":"'Meiryo'",this.size=i?i+"px":"10px",this.string=t?t:"",this.color=e?e:"white"},setSize:function(t){this.size=t+"px"},setFont:function(t){this.font="'"+t+"'"},intersect:function(t,e){var i=this.x,s=this.y,h=parseInt(this.size)*this.scaleX*this.string.length,n=parseInt(this.size)*this.scaleY,r=t-(i+h/2),a=e-(s+n/2),o=this.rot,c=Math.sin(-o),l=Math.cos(-o),u=Math.abs(r*l-a*c),d=Math.abs(r*c+a*l);return h/2>u&&n/2>d?!0:!1},scale:function(t,e){this.scaleX*=t,this.scaleY*=e},_scaleBy:function(t){0==t.time&&(t.diffWidth=t.scaleX-this.scaleX,t.diffHeight=t.scaleY-this.scaleY),this.scaleX=t.scaleX-t.diffWidth*(1-t.time/t.frame),this.scaleY=t.scaleY-t.diffHeight*(1-t.time/t.frame)},draw:function(){var t=this.x,e=this.y,i=this.scaleX,s=this.scaleY,h=this.ctx,n=this.string.split("<br>"),r=n.length;h.globalAlpha=this.alpha,h.globalCompositeOperation=this.drawMode,h.font=this.size+" "+this.font;var a=1.5*h.measureText("a").width+this.spaceWidth;h.fillStyle=this.color,h.save();var o=parseInt(this.size)*this.scaleX*this.string.length/2,c=parseInt(this.size)*this.scaleY/2;h.translate(t+o,e+c),h.rotate(this.rot),h.translate(-o,-c),h.scale(i,s);for(var l=0;r>l;l++)h.fillText(n[l],0,a),a*=2;h.restore(),h.globalAlpha=1}}),w=c.createClass(v,{initialize:function(){this.inherit(),this.children=[],this._basicConstructor="Group";for(var t=0,e=arguments.length;e>t;t++)this.children.push(arguments[t])},draw:function(){for(var t=this.children,e=0,i=t.length;i>e;e++){var s=t[e];s.x+=this.x,s.y+=this.y,s.useEvent&&s.useEvent(),s.enterFrame&&s.enterFrame(),s.tween&&s.tween(),s.visible&&s.draw(),s._remove&&(this.splice(e,1),s=null,e--,i--),s.x-=this.x,s.y-=this.y}},scale:function(t,e){for(var i=this.children,s=0,h=arguments.length;h>s;s++){var n=i[s];n.scale&&n.scale(t,e)}},addChild:function(t){t.parent=this,this.children.push(t)},addChildren:function(){for(var t=0,e=arguments.length;e>t;t++)this.addChild(arguments[t])}});window.Atlas=c,c.Util=u,c.Thing=v,c.App=f,c.Sprite=m,c.Shape=p,c.Map=g,c.Text=y,c.Scene=d,c.Group=w}();
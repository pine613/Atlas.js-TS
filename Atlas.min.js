!function(){"use strict";var a=[],b=[],c=[],d=0,e=function(){var a=navigator.userAgent;return a.indexOf("iPhone")>0&&-1==a.indexOf("iPad")||a.indexOf("iPod")>0||a.indexOf("Android")>0?!0:!1}(),f=function(){var a=window.matchMedia("(orientation: portrait)");return a.matches?"portrait":"landscape"}(),g=function(a,b,c){var d=c.which;switch(d){case 13:a.enter=!0,b.enter=!0;break;case 16:a.shift=!0,b.shift=!0;break;case 32:a.space=!0,b.space=!0;break;case 39:a.right=!0,b.right=!0;break;case 37:a.left=!0,b.left=!0;break;case 38:a.up=!0,b.up=!0;break;case 40:a.down=!0,b.down=!0;break;case 8:a.backspace=!0,b.backspace=!0}for(var e=0;26>e;e++)if(e+65==d){var f=String.fromCharCode(e+97);a[f]=!0,b[f]=!0;break}},h=function(a){a.enter=!1,a.shift=!1,a.space=!1,a.right=!1,a.left=!1,a.up=!1,a.down=!1,a.backspace=!1;for(var b=0;26>b;b++)a[String.fromCharCode(b+97)]=!1},i=function(){var a=new Object;return h(a),a}(),j=function(){for(var a in j)window[a]=j[a]};j.createClass=function(a,b){var c=function(){this.initialize.apply(this,arguments)};"function"==typeof a&&"object"==typeof b?(c.prototype=Object.create(a.prototype),c.prototype.inherit=function(){this.initialize=this.superClass.prototype.initialize,this.superClass=this.superClass.prototype.superClass,this.initialize&&this.initialize.apply(this,arguments)}):"object"==typeof a&&null==b&&(b=a);for(var d in b)c.prototype[d]=b[d];return c.prototype.superClass=a,c},j.extendClass=function(a,b){for(var c in b)a.prototype[c]=b[c]};var k=function(a,b,c){var d=a.mover,e=d[d.length-1];if(e&&e.and)var f=e;else{var f=new Object;d.push(f)}return f.time=0,c&&(f.frame=c),f.loop=!1,f.and=!1,f[b]=!0,f};j.Util=j.createClass({isMobile:e,orientation:f,initialize:function(){this.eventListener=new Object,this.mover=[],this.rot=0,this.moverIndex=0,this.visible=!0,this.eventEnable=!0,this.drawMode="source-over";var a=this.eventListener;a.touchStart=!1,a.touchMove=!1,a.touchEnd=!1,a.keyUp=!1,a.keyDown=!1,a.multiTouchStart=!1,a.multiTouchMove=!1,a.multiTouchEnd=!1,a.orientationChange=!1},tween:function(){var a=this.mover,b=a.length;if(this.moverIndex<b){var c=a[this.moverIndex];c.animate&&this._animate(c),c.moveTo&&this._moveTo(c),c.moveBy&&this._moveBy(c),c.rotateBy&&this._rotateBy(c),c.scaleBy&&this._scaleBy(c),c.then&&this._then(c),c.time++,c.time>c.frame&&(this.moverIndex++,this.moverIndex==b&&(c.loop?this._refresh():this.stop()))}},isQueEmpty:function(){return this.mover.length?!1:!0},_refresh:function(){this.moverIndex=0;for(var a=this.mover,b=0,c=a.length;c>b;b++){var d=a[b];d.time&&(d.time=0)}},moveTo:function(a,b,c){var d=k(this,"moveTo",c);return d.toX=a,d.toY=b,this},_moveTo:function(a){0==a.time&&(a.diffX=a.toX-this.x,a.diffY=a.toY-this.y),this.x=a.toX-a.diffX*(1-a.time/a.frame),this.y=a.toY-a.diffY*(1-a.time/a.frame)},moveBy:function(a,b,c){var d=k(this,"moveBy",c);return d.diffX=a,d.diffY=b,this},_moveBy:function(a){0==a.time&&(a.toX=this.x+a.diffX,a.toY=this.y+a.diffY),this.x=a.toX-a.diffX*(1-a.time/a.frame),this.y=a.toY-a.diffY*(1-a.time/a.frame)},delay:function(a){var b=k(this,"delay",a);return this.mover.push(b),this},and:function(){var a=this.mover,b=a[a.length-1];return b&&(b.and=!0),this},stop:function(){return this.mover=[],this.moverIndex=0,this},loop:function(){var a=this.mover[this.mover.length-1];return a.loop=!0,this},rotateBy:function(a,b){var c=k(this,"rotateBy",b);return c.diffAngle=a,this},_rotateBy:function(a){0==a.time&&(a.toAngle=this.rot+a.diffAngle),this.rot=a.toAngle-a.diffAngle*(1-a.time/a.frame)},then:function(a,b){var c=k(this,"then",b);return c.exec=a,this},_then:function(a){a.exec.call(this)},scaleBy:function(a,b,c){var d=k(this,"scaleBy",c);return d.scaleX=a,d.scaleY=b,this},setPosition:function(a,b){return this.x=a,this.y=b,this},saveData:function(a){var b=new Object;for(var c in this)"function"!=typeof this[c]&&(b[c]=this[c]);localStorage.setItem(a,JSON.stringify(b))},getData:function(a){var b=JSON.parse(localStorage.getItem(a));for(var c in b)this[c]=b[c]},getTouchPosition:function(a,b){b&&a.touches[b]||(b=0);var c=this.field,d=parseInt(c.width)/parseInt(c.style.width),f=parseInt(c.height)/parseInt(c.style.height),g=new Object,h=c.getBoundingClientRect(),i=parseInt(h.left),j=parseInt(h.top);isNaN(i)&&(i=0),isNaN(j)&&(j=0);var k=document.documentElement.scrollLeft||document.body.scrollLeft,l=document.documentElement.scrollTop||document.body.scrollTop;return a?!e||e&&a.touches[b]?(g.x=(e?a.touches[b].pageX:a.pageX)-i-k,g.y=(e?a.touches[b].pageY:a.pageY)-j-l):(g.x=-1,g.y=-1):(g.x=event.x-i,g.y=event.y-j),g.x=parseInt(g.x*d),g.y=parseInt(g.y*f),g},getMultiTouchPosition:function(a){for(var b=a.touches.length,c=[],d=0;b>d;d++)c[d]=this.getTouchPosition(a,d);return c},handleEvent:function(a){if(this.eventEnable){a.preventDefault();var b=this.getTouchPosition(a);b.touchCount=a.touches?a.touches.length:1,b.event=a;var c=a.type;if("keydown"==c||"keyup"==c){var d=new Object;for(var e in i)d[e]=i[e];g(d,i,a)}switch(c){case"touchstart":this.multiTouchStart&&a.touches.length>1?this.multiTouchStart(this.getMultiTouchPosition(a)):this.touchStart&&this.touchStart(b);break;case"mousedown":this.touchStart&&this.touchStart(b);break;case"touchmove":this.multiTouchMove&&a.touches.length>1?this.multiTouchMove(this.getMultiTouchPosition(a)):this.touchMove&&this.touchMove(b);break;case"mousemove":this.touchMove&&this.touchMove(b);break;case"touchend":this.multiTouchEnd&&a.touches.length>1?this.multiTouchEnd(this.getMultiTouchPosition(a)):this.touchEnd&&this.touchEnd(b);break;case"mouseup":this.touchEnd&&this.touchEnd();break;case"keydown":this.keyDown&&this.keyDown(i);break;case"keyup":this.keyUp&&this.keyUp(d)}}},useEvent:function(){var a=this.field,b=this.eventListener;this.touchStart&&0==b.touchStart&&(e?a.addEventListener("touchstart",this,!1):a.addEventListener("mousedown",this,!1),b.touchStart=!0),this.touchMove&&0==b.touchMove&&(e?a.addEventListener("touchmove",this,!1):a.addEventListener("mousemove",this,!1),b.touchMove=!0),this.touchEnd&&0==b.touchEnd&&(e?a.addEventListener("touchend",this,!1):a.addEventListener("mouseup",this,!1),b.touchEnd=!0),this.multiTouchStart&&0==b.multiTouchStart&&(b.touchStart||(e?a.addEventListener("touchstart",this,!1):a.addEventListener("mousedown",this,!1)),b.touchStart=!0),this.multiTouchMove&&0==b.multiTouchMove&&(b.touchMove||(e?a.addEventListener("touchmove",this,!1):a.addEventListener("mousemove",this,!1)),b.touchMove=!0),this.multiTouchEnd&&0==b.multiTouchEnd&&(b.touchEnd||(e?a.addEventListener("touchend",this,!1):a.addEventListener("mouseup",this,!1)),b.touchEnd=!0),this.keyUp&&0==b.keyUp&&(a.addEventListener("keyup",this,!1),b.keyUp=!0),this.keyDown&&0==b.keyDown&&(a.addEventListener("keydown",this,!1),b.keyDown=!0)},remove:function(){this._remove=!0},leave:function(){this._leave=!0},getRand:function(a,b){return~~(Math.random()*(b-a+1))+a},HSBtoRGB:function(a,b,c){var d,e,f,g,h,i,j,k;switch(e=Math.floor(a/60)%6,d=a/60-Math.floor(a/60),f=Math.round(c*(1-b/255)),g=Math.round(c*(1-b/255*d)),h=Math.round(c*(1-b/255*(1-d))),e){case 0:i=c,j=h,k=f;break;case 1:i=g,j=c,k=f;break;case 2:i=f,j=c,k=h;break;case 3:i=f,j=g,k=c;break;case 4:i=h,j=f,k=c;break;case 5:i=c,j=f,k=g}return i=15>=i?"0"+i.toString(16):i.toString(16),j=15>=j?"0"+j.toString(16):j.toString(16),k=15>=k?"0"+k.toString(16):k.toString(16),"#"+i+j+k},getSound:function(a){for(var c=0,d=b.length;d>c;c++)a==b[c].name&&(this.sound=new Audio(b[c].src))},soundClonePlay:function(){var a=this.sound;a&&new Audio(a.src).play()},soundLoopPlay:function(){var a=this.sound;a&&(a.loop||a.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),a.loop=!0,a.play())},soundReplay:function(){var a=this.sound;a&&(a.load(),a.play())},soundStop:function(){var a=this.sound;a.paused?a.load():(a.pause(),a.currentTime=0)},soundPlay:function(){var a=this.sound;a&&a.play()},soundPause:function(){var a=this.sound;a&&a.pause()},soundGetCount:function(){var a=this.sound;return a?a.currentTime:void 0},soundSetCount:function(a){var b=this.sound;b&&(b.currentTime=a)},soundGetVolume:function(){var a=this.sound;return a?a.volume:void 0},soundSetVolume:function(a){var b=this.sound;b&&(b.volume=a)},soundGetAlltime:function(){var a=this.sound;return a?a.duration:void 0},soundIsPlaying:function(){var a=this.sound;return a?!a.paused:void 0}}),j.App=j.createClass(j.Util,{initialize:function(a){this.inherit(),this._basicConstructor="App";var b=document.createElement("style");b.media="screen",b.type="text/css",document.getElementsByTagName("head")[0].appendChild(b);var c;if(a)c=document.getElementById(a);else{c=document.createElement("canvas");var d=document.getElementsByTagName("body").item(0);d.appendChild(c)}c.width=320,c.height=480,c.style.top="0px",c.style.left="0px",c.tabIndex="1",document.body.style.margin="0em";navigator.userAgent;e?(c.style.width=window.innerWidth+"px",c.style.height=window.innerHeight+"px",c.addEventListener("touchstart",function(){this.focus()})):(c.style.width="480px",c.style.height="620px",c.addEventListener("mousedown",function(){this.focus()}),c.addEventListener("keyup",function(){h(i)},!1)),this._css=b,this.field=c,this.ctx=c.getContext("2d"),this.fps=30,this.scene=new Scene,this.scene.ctx=this.ctx,this.scene.field=this.field,this.scene.parent=this},getCanvasURL:function(){return this.field.toDataURL()},getCanvasImage:function(){var a=this.field.toDataURL();window.open(a,"_blank")},colorToAlpha:function(b,c){for(var d,e=0,f=a.length;f>e;e++)a[e].name==b&&(d=a[e],d.hex=c,d.index=e);d.addEventListener("load",function(){var b=document.createElement("canvas"),c=b.getContext("2d"),d=this.width,e=this.height,f=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,g=this.hex.replace(f,function(a,b,c,d){return b+b+c+c+d+d}),h=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(g),i=h?{r:parseInt(h[1],16),g:parseInt(h[2],16),b:parseInt(h[3],16)}:null;c.drawImage(this,0,0);for(var j=c.getImageData(0,0,d,e),k=j.data,l=0;e>l;l++)for(var m=0;d>m;m++){var n=4*l*d+4*m;k[n]==i.r&&k[n+1]==i.g&&k[n+2]==i.b&&(k[n+3]=0)}c.putImageData(j,0,0);var o=new Image;o.src=b.toDataURL(),a[this.index]=o})},addChild:function(a){a.ctx=this.ctx,a.field=this.field,this.scene.addChild(a)},addChildren:function(){for(var a=0,b=arguments.length;b>a;a++)this.addChild(arguments[a])},centerize:function(){var a=this.field.style;a.marginTop=-parseInt(a.height)/2+"px",a.marginLeft=-parseInt(a.width)/2+"px",a.top="50%",a.left="50%",a.position="absolute"},fitWindow:function(){this.setSize(window.innerWidth,window.innerHeight);var a=this;window.onresize=function(){a.setSize(window.innerWidth,window.innerHeight)}},setQuality:function(a,b){var c=this.field;c.width=a,c.height=b},setSize:function(a,b){var c=this.field.style;c.width=a+"px",c.height=b+"px"},getSize:function(){var a=new Object;return a.width=parseInt(this.field.style.width),a.height=parseInt(this.field.style.height),a},getQuality:function(){var a=new Object;return a.width=parseInt(this.field.width),a.height=parseInt(this.field.height),a},loadingScene:function(a){this.preScene=a,this.preScene.parent=this},_preLoadEnterFrame:function(){var a=this.field;this.useEvent();var b=this.ctx;if(b.clearRect(0,0,a.width,a.height),d>0)this.preScene&&this.preScene._enterFrame();else{this.onLoad&&this.onLoad();for(var c=this.scene.children,e=0,f=c.length;f>e;e++){var g=c[e];g._onLoad&&g._onLoad(),g.onLoad&&g.onLoad()}clearInterval(this.preLoadInterval);var h=this;setInterval(function(){h._enterFrame()},1e3/this.fps)}},_enterFrame:function(){var a=this.field;this.ctx.clearRect(0,0,a.width,a.height),this.useEvent(),this.enterFrame&&this.enterFrame(),this.scene._enterFrame()},pushScene:function(a){for(var b=this.ctx,c=this.field,d=this.scene.children,e=0,f=d.length;f>e;e++){var g=d[e];g.eventEnable=!1,g.onSceneremoved&&g.onSceneRemoved()}d=a.children;for(var e=0,f=d.length;f>e;e++){var h=d[e];h.ctx=b,h.field=c,h.eventEnable=!0,h.onScenePushed&&h.onScenePushed()}a.parent=this,a.ctx=b,a.field=c;var i=this.field.style;i.background=null,i.backgroundColor="white",a.color&&this.setColor(a.color),a.image&&this.setImage(a.image),this.scene=a},setColor:function(a){var b=this.field.style;b.background=null,b.backgroundColor=a},setImage:function(a){var b=this.field.style;b.background="url("+a+") no-repeat center",b.backgroundSize="cover"},start:function(){var a=this.field,b=this;this.ctx.clearRect(0,0,a.width,a.height),this.preLoadInterval=setInterval(function(){b._preLoadEnterFrame()},1e3/this.fps)},toDataURL:function(){return this.field.toDataURL()},load:function(){function e(a){var b;if(!a)return b;var c=a.split("."),d=c.length;return 0===d?b:b=c[d-1]}for(var f=0,g=arguments.length;g>f;f++){var h=arguments[f];if(h instanceof Array)var i=h[0],j=h[1];else var i=h,j=h;var k=e(i);if("wav"==k||"mp3"==k||"ogg"==k){var h=new Audio(i);h.name=j,d++,h.addEventListener("canplaythrough",function(){d--,console.log(this.src+" is loaded")}),b.push(h)}else if("TTF"==k||"ttf"==k){var l=this._css,m=document.createTextNode("@font-face{font-family:'"+j+"';src: url('"+i+"') format('truetype');}");l.styleSheet?l.styleSheet.cssText=m:l.appendChild(m)}else if("svg"==k){var h=document.createElement("object");h.addEventListener("load",function(){d--,this.style.display="none",console.log(this.data+" is loaded")}),h.data=i,h.name=j,document.body.appendChild(h),d++,c.push(h)}else if("png"==k||"gif"==k||"jpeg"==k||"jpg"==k){var h=new Image;h.addEventListener("load",function(){d--,console.log(this.src+" is loaded")}),h.src=i,h.name=j,d++,a.push(h)}}}}),j.Thing=j.createClass(j.Util,{initialize:function(a,b){this.inherit(),this.x=0,this.y=0,this._remove=!1,this.width=a,this.height=b,this.collisionShape="box",this.alpha=1,this.field},_scaleBy:function(a){0==a.time&&(a.toWidth=this.width*a.scaleX,a.toHeight=this.height*a.scaleY,a.diffWidth=a.toWidth-this.width,a.diffHeight=a.toHeight-this.height),this.width=a.toWidth-a.diffWidth*(1-a.time/a.frame),this.height=a.toHeight-a.diffHeight*(1-a.time/a.frame)},intersect:function(a,b){var c=this._x||this.x,d=this._y||this.y,e=this._width||this.width,f=this._height||this.height,g=this._rot||this.rot;if("box"==this.collisionShape){var h=a-(c+e/2),i=b-(d+f/2),j=Math.sin(-g),k=Math.cos(-g),l=Math.abs(h*k-i*j),m=Math.abs(h*j+i*k);return e/2>l&&f/2>m?!0:!1}if("circle"==this.collisionShape){var n=e/2,h=a-(c+n),i=b-(d+n);return Math.sqrt(h*h+i*i)<n?!0:!1}return!1},hitTest:function(a){var b=this._x||this.x,c=this._y||this.y,d=this._width||this.width,e=this._height||this.height,f=b+d/2,g=c+e/2,h=a._x||a.x,i=a._y||a.y,j=a._width||a.width,k=a._height||a.height,l=a._rot||a.rot;if("box"!=this.collisionShape)return"circle"==this.collisionShape?this.within(a,d/2):!1;if("circle"==a.collisionShape)return a.within(this,j/2);if(0!=l&&l!=Math.PI&&"box"==a.collisionShape){var m=h+j/2,n=i+k/2,f=b+d/2,g=c+e/2,o=-l;f=Math.cos(o)*(f-m)-Math.sin(o)*(g-n)+m,g=Math.sin(o)*(f-m)+Math.cos(o)*(g-n)+n,b=f-d/2,c=g-e/2}return h+j>b&&b+d>h&&i+k>c&&c+e>i},within:function(a,b){var c=this._x||this.x,d=this._y||this.y,e=this._width||this.width,f=this._height||this.height,g=(this._rot||this.rot,a._x||a.x),h=a._y||a.y,i=a._width||a.width,j=a._height||a.height,k=a._rot||a.rot;if("box"==this.collisionShape)var l=c+e/2,m=d+f/2;else{if("circle"!=this.collisionShape)return!1;var n=e/2,l=c+n,m=d+n}if("box"==a.collisionShape){var o,p,q=g+i/2,r=h+j/2,s=-k,t=Math.cos(s)*(l-q)-Math.sin(s)*(m-r)+q,u=Math.sin(s)*(l-q)+Math.cos(s)*(m-r)+r;o=g>t?g:t>g+i?g+i:t,p=h>u?h:u>h+j?h+j:u;var v=Math.abs(t-o),w=Math.abs(u-p)}else{if("circle"!=a.collisionShape)return!1;var x=i/2,o=g+x,p=h+x,v=Math.abs(l-o),w=Math.abs(m-p);b+=x}return Math.sqrt(v*v+w*w)<b?!0:!1},scale:function(a,b){return this.width?(this.width*=a,this.height*=b):(this._scaleX=a,this._scaleY=b),this},setSize:function(a,b){this.width=a,this.height=b}}),j.Shape=j.createClass(j.Thing,{initialize:function(a,b,c){this.inherit(0,0),this.obj=-1,"object"==typeof a?this.path=a:"string"==typeof a&&this.setImage(a),this.closeMode=!0,this.color=b?b:"original",this.strokeColor=c?c:"original"},setImage:function(a){for(var b=0,d=c.length;d>b;b++)a==c[b].name&&(this.obj=b)},parsePath:function(a){var b={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},c=/([astvzqmhlc])([^astvzqmhlc]*)/gi,d=[];return a.replace(c,function(a,c,e){var f=c.toLowerCase();for(e=e.match(/-?[.0-9]+(?:e[-+]?\d+)?/gi),e=e?e.map(Number):[],"m"==f&&e.length>2&&(d.push([c].concat(e.splice(0,2))),f="l",c="m"==c?"l":"L");;){if(e.length==b[f]){if(e.unshift(c),"q"==e[0])var g={method:"quadraticCurveBy",cpx:e[1],cpy:e[2],x:e[3],y:e[4]};else if("Q"==e[0])var g={method:"quadraticCurveTo",cpx:e[1],cpy:e[2],x:e[3],y:e[4]};else if("l"==e[0])var g={method:"lineBy",x:e[1],y:e[2]};else if("L"==e[0])var g={method:"lineTo",x:e[1],y:e[2]};else if("m"==e[0])var g={method:"moveBy",x:e[1],y:e[2]};else if("M"==e[0])var g={method:"moveTo",x:e[1],y:e[2]};else if("c"==e[0])var g={method:"bezierCurveBy",cpx1:e[1],cpy1:e[2],cpx2:e[3],cpy2:e[4],x:e[5],y:e[6]};else if("C"==e[0])var g={method:"bezierCurveTo",cpx1:e[1],cpy1:e[2],cpx2:e[3],cpy2:e[4],x:e[5],y:e[6]};else if("h"==e[0])var g={method:"horizontalBy",x:e[1]};else if("H"==e[0])var g={method:"horizontalTo",x:e[1]};else if("v"==e[0])var g={method:"verticalBy",y:e[1]};else if("V"==e[0])var g={method:"verticalTo",y:e[1]};else if("s"==e[0])var g={method:"bezierCurveShortBy",cpx2:e[1],cpy2:e[2],x:e[3],y:e[4]};else if("S"==e[0])var g={method:"bezierCurveShortTo",cpx2:e[1],cpy2:e[2],x:e[3],y:e[4]};else if("t"==e[0])var g={method:"quadraticCurveShortBy",x:e[1],y:e[2]};else if("T"==e[0])var g={method:"quadraticCurveShortTo",x:e[1],y:e[2]};else var g={};return d.push(g)}d.push([c].concat(e.splice(0,b[f])))}}),d},_onLoad:function(){var a=c[this.obj].getSVGDocument(),b=a.getElementsByTagName("path")[0],d=a.getElementsByTagName("svg")[0],e=b.getAttribute("d");"original"==this.color&&(this.color=b.getAttribute("fill")),"original"==this.strokeColor&&this.strokeColor==b.getAttribute("stroke"),this.path=this.parsePath(e),this.spriteWidth=parseInt(d.getAttribute("width")),this.spriteHeight=parseInt(d.getAttribute("height")),this.width||(this.width=this.spriteWidth),this.height||(this.height=this.spriteHeight)},draw:function(){this.path||this._onLoad();var a=this.path,b=this.ctx,c=0,d=0,e=0,f=0,g=0,h=0,i=this.width,j=this.height,k=i/this.spriteWidth,l=j/this.spriteHeight,m=i/2,n=j/2,o=this._x||this.x,p=this._y||this.y,q=this._rot||this.rot;b.globalAlpha=this.alpha,b.globalCompositeOperation=this.drawMode,b.save(),b.translate(o+m,p+n),b.rotate(q),b.translate(-m,-n),b.scale(k,l),b.beginPath();for(var r=0,s=a.length;s>r;r++){var t=this.path[r],u=t.method;"moveTo"==u||"quadraticCurveTo"==u||"bezierCurveTo"==u||"lineTo"==u||"bezierCurveShortTo"==u||"quadraticCurveShortTo"==u?(e=0,f=0,c=t.x,d=t.y):(e=c,f=d,c+=t.x,d+=t.y),"moveTo"==u||"moveBy"==u?b.moveTo(c,d):"lineTo"==u||"lineBy"==u?b.lineTo(c,d):"quadraticCurveBy"==u||"quadraticCurveTo"==u?(b.quadraticCurveTo(e+t.cpx,f+t.cpy,c,d),g=2*c-(e+t.cpx),h=2*d-(f+t.cpy)):"bezierCurveTo"==u||"bezierCurveBy"==u?(b.bezierCurveTo(e+t.cpx1,f+t.cpy1,e+t.cpx2,f+t.cpy2,c,d),g=2*c-(e+t.cpx2),h=2*d-(f+t.cpy2)):"horizontalTo"==u||"horizontalBy"==u?b.lineTo(t.x,d):"verticalTo"==u||"verticalBy"==u?b.lineTo(c,t.y):"bezierCurveShortBy"==u||"bezierCurveShortTo"==u?(b.bezierCurveTo(g,h,e+t.cpx2,f+t.cpy2,c,d),g=2*c-(e+t.cpx2),h=2*d-(f+t.cpy2)):("quadraticCurveShortBy"==u||"quadraticCurveShortTo"==u)&&(b.quadraticCurveTo(g,h,c,d),g=2*c-g,h=2*d-h)}this.closeMode&&b.closePath(),b.fillStyle=this.color,b.fill(),b.strokeStyle=this.strokeColor,b.stroke(),b.restore()},getNodeByName:function(a){for(var b=this.path,c=0,d=b.length;d>c;c++){var e=b[c];if(a==e.name)return e}return-1}}),j.Shape.Box=j.createClass(j.Thing,{initialize:function(a,b,c){this.inherit(b,c),this._basicConstructor="Shape",this.color=a},draw:function(){var a=this.ctx;a.globalAlpha=this.alpha,a.globalCompositeOperation=this.drawMode,a.beginPath(),a.fillStyle=this.color;var b=this._x||this.x,c=this._y||this.y,d=this._rot||this.rot,e=(this._width||this.width,this._height||this.height,b+this.width/2),f=c+this.height/2;a.save(),a.translate(e,f),a.rotate(d),a.translate(-e,-f);var b=this._x||this.x,c=this._y||this.y;a.fillRect(b,c,this.width,this.height),a.restore(),a.globalAlpha=1}}),j.Shape.Circle=j.createClass(j.Thing,{initialize:function(a,b){this.inherit(2*b,2*b),this._basicConstructor="Shape",this.color=a,this.collisionShape="circle"},draw:function(){var a=this.ctx;a.globalAlpha=this.alpha,a.globalCompositeOperation=this.drawMode,a.beginPath(),a.fillStyle=this.color;var b=this._width||this.width,c=b/2,d=this._x||this.x,e=this._y||this.y;a.arc(d+c,e+c,c,0,2*Math.PI,!1),a.fill(),a.globalAlpha=1}}),j.Sprite=j.createClass(j.Thing,{initialize:function(a,b,c){"undefined"==typeof b&&(b=null,c=null),this.inherit(b,c),this.setImage(a,b,c),this._basicConstructor="Sprite",this.frame=0,this.alpha=1},animate:function(a,b,c){var d=k(this,"animate",c);return d.array=a,d.frameRate=b,d.frameIdx=0,this},_animate:function(a){0==a.time&&(this.frame=a.array[0]),a.time%a.frameRate==0&&(a.frameIdx=(a.frameIdx+1)%a.array.length,this.frame=a.array[a.frameIdx])},setSpriteSize:function(a,b){this.spriteWidth=a,this.spriteHeight=b},setImage:function(b,c,d){c&&d&&this.setSpriteSize(c,d);for(var e=a.length,f=0;e>f;f++)a[f].name==b&&(this.img=f)},getImage:function(){return a[this.img]},getImageSize:function(){var b={},c=a[this.img];return b.width=c.width,b.height=c.height,b},draw:function(){var b=this.ctx;b.globalAlpha=this.alpha,b.globalCompositeOperation=this.drawMode;var c=this.frame,d=a[this.img],e=this.spriteWidth,f=this.spriteHeight,g=this._width||this.width,h=this._height||this.height,i=g/2,j=h/2,k=d.width/e,l=d.height/f,m=g/e,n=h/f,o=c%k*e,p=~~(c/k)%l*f,q=this._x||this.x,r=this._y||this.y,s=this._rot||this.rot;b.save(),b.translate(q+i,r+j),b.rotate(s),b.translate(-i,-j),b.scale(m,n),null!=o&&b.drawImage(d,o,p,e,f,0,0,e,f),b.restore(),b.globalAlpha=1}}),j.Map=j.createClass(j.Sprite,{initialize:function(a,b,c){this.inherit(a,b,c),this.drawData,this.hitData},intersect:function(a,b){for(var c=this.hitData,d=c[0].length,e=c.length,f=this._width||this.width,g=this._height||this.height,h=this._x||this.x,i=this._y||this.y,j=0;e>j;j++)for(var k=0;d>k;k++)if(1==c[j][k]&&a>h+k*f&&h+(k+1)*f>a&&b>i+j*g&&i+(j+1)*g>b)return!0;return!1},draw:function(){var b=this.drawData,c=b[0].length,d=b.length,e=this._width||this.width,f=this._height||this.height,g=this._x||this.x,h=this._y||this.y,i=0,j=0,k=this.field,l=this.ctx;l.globalAlpha=this.alpha,l.globalCompositeOperation=this.drawMode;for(var m,n=k.height,o=k.width,p=a[this.img],q=this.spriteWidth,r=this.spriteHeight,s=p.width/q,t=p.height/r,u=this.width/q,v=this.height/r,w=g,x=h;d>i;){for(;c>j;){if(m=b[i][j],m>=0&&n>h+f*i&&h+f*(i+1)>0&&o>g+e*j&&g+e*(j+1)>0){var y=m%s*q,z=~~(m/s)%t*r;l.save(),l.translate(w,x),l.scale(u,v),l.drawImage(p,y,z,q,r,0,0,q,r),l.restore()}w+=e,j++}x+=f,w=g,i++,j=0}}}),j.Text=j.createClass(j.Util,{initialize:function(a,b,c,d){this.inherit(),this._basicConstructor="Text",this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.spaceWidth=7,this.font=d?"'"+d+"'":"'Meiryo'",this.size=c?c+"px":"10px",this.string=a?a:"",this.color=b?b:"white"},setSize:function(a){this.size=a+"px"},setFont:function(a){this.font="'"+a+"'"},intersect:function(a,b){var c=this._x||this.x,d=this._y||this.y,e=parseInt(this.size)*this.scaleX*this.string.length,f=parseInt(this.size)*this.scaleY,g=a-(c+e/2),h=b-(d+f/2),i=this._rot||this.rot,j=Math.sin(-i),k=Math.cos(-i),l=Math.abs(g*k-h*j),m=Math.abs(g*j+h*k);return e/2>l&&f/2>m?!0:!1},scale:function(a,b){this.scaleX*=a,this.scaleY*=b},_scaleBy:function(a){0==a.time&&(a.diffWidth=a.scaleX-this.scaleX,a.diffHeight=a.scaleY-this.scaleY),this.scaleX=a.scaleX-a.diffWidth*(1-a.time/a.frame),this.scaleY=a.scaleY-a.diffHeight*(1-a.time/a.frame)},draw:function(){var a=this._x||this.x,b=this._y||this.y,c=this._rot||this.rot,d=this.scaleX,e=this.scaleY,f=this.ctx,g=this.string.split("<br>"),h=g.length;f.globalAlpha=this.alpha,f.globalCompositeOperation=this.drawMode,f.font=this.size+" "+this.font;var i=1.5*f.measureText("a").width+this.spaceWidth;f.fillStyle=this.color,f.save();var j=parseInt(this.size)*this.scaleX*this.string.length/2,k=parseInt(this.size)*this.scaleY/2;f.translate(a+j,b+k),f.rotate(c),f.translate(-j,-k),f.scale(d,e);for(var l=0;h>l;l++)f.fillText(g[l],0,i),i*=2;f.restore(),f.globalAlpha=1}}),j.Group=j.createClass(j.Thing,{initialize:function(){this.children=[],this.inherit(),this.x=0,this.y=0,this._basicConstructor="Group"},draw:function(){for(var a=this.children,b=0,c=a.length;c>b;b++){var d=a[b];d._x=d.x+this.x,d._y=this.y+this.y}},addChild:function(a){a.parent=this,this.children.push(a)},addChildren:function(){for(var a=0,b=arguments.length;b>a;a++)this.addChild(arguments[a])},getChild:function(a){var b=this.getChildren(a),c=b[0];return c||(c=null),c},getChildren:function(a){for(var b=[],c=this.children,d=0,e=c.length;e>d;d++){var f=!0;for(var g in a)if("$not"==g)for(var h in a.$not)a.$not[h]==c[d][h]&&(f=!1);else a[g]!=c[d][g]&&(f=!1);1==f&&b.push(c[d])}return b},removeChild:function(a){var b=this.getChild(a);b.remove()},removeChildren:function(a){for(var b=this.getChildren(a),c=0,d=b.length;d>c;c++)b[c].remove()}}),j.Scene=j.createClass(j.Group,{initialize:function(){this.inherit(),this._basicConstructor="Scene",this._remove=!1},addChild:function(a){if(a.parent=this,this.ctx&&this.field&&(a.ctx=this.ctx,a.field=this.field),this.children.push(a),"Group"==a._basicConstructor||"Layer"==a._basicConstructor)for(var b=a.children,c=0,d=b.length;d>c;c++){var e=b[c];e.ctx||(e.ctx=this.ctx,e.field=this.field,this.children.push(e))}},setImage:function(a){this.image=a},setColor:function(a){this.color=a},_enterFrame:function(){this.enterFrame&&this.enterFrame();for(var a=this.children,b=0,c=a.length;c>b;b++){var d=a[b];if(d._remove)a.splice(b,1),d=null,b--,c--;else{if("Sprite"==d._basicConstructor&&!d.spriteWidth){var e=d.getImageSize();e.width&&(d.setSpriteSize(e.width,e.height),d.width||(d.setSize(e.width,e.height),d._scaleX&&d.scale(d._scaleX,d._scaleY)))}d.useEvent&&d.useEvent(),d._enterFrame&&d._enterFrame(),d.enterFrame&&d.enterFrame(),d.tween&&d.tween(),d.visible&&(d.preDraw&&d.preDraw(),d.draw())}}}}),j.Layer=j.createClass(j.Group,{initialize:function(){this.inherit(),this.rot=0,this._basicConstructor="Layer",this.firstWidth=100,this.firstHeight=100,this.height=100,this.width=100,this.scaleX=1,this.scaleY=1},fitToChildren:function(){var a=this.children,b=this.x,c=this.y;this.x=null,this.y=null,this.width=0,this.height=0;for(var d=0,e=a.length;e>d;d++){var f=a[d],g=f._x||f.x,h=f._y||f.y,i=f._width||f.width,j=f._height||f.height,k=g+i/2,l=h+j/2,m=f._rot||f.rot;if(m%=2*Math.PI,0>m&&(m+=2*Math.PI),m>=0&&m<=Math.PI/2)var n=Math.cos(m)*(g-k)-Math.sin(m)*(h+j-l)+k,o=Math.cos(m)*(g+i-k)-Math.sin(m)*(h-l)+k,p=Math.sin(m)*(g-k)+Math.cos(m)*(h-l)+l,q=Math.sin(m)*(g+i-k)+Math.cos(m)*(h+j-l)+l;else if(Math.PI/2<m&&m<=Math.PI)var n=Math.cos(m)*(g+i-k)-Math.sin(m)*(h+j-l)+k,o=Math.cos(m)*(g-k)-Math.sin(m)*(h-l)+k,p=Math.sin(m)*(g-k)+Math.cos(m)*(h+j-l)+l,q=Math.sin(m)*(g+i-k)+Math.cos(m)*(h-l)+l;else if(Math.PI<m&&m<=1.5*Math.PI)var n=Math.cos(m)*(g+i-k)-Math.sin(m)*(h-l)+k,o=Math.cos(m)*(g-k)-Math.sin(m)*(h+j-l)+k,p=Math.sin(m)*(g+i-k)+Math.cos(m)*(h+j-l)+l,q=Math.sin(m)*(g-k)+Math.cos(m)*(h-l)+l;else if(1.5*Math.PI<m&&m<=2*Math.PI)var n=Math.cos(m)*(g-k)-Math.sin(m)*(h-l)+k,o=Math.cos(m)*(g+i-k)-Math.sin(m)*(h+j-l)+k,p=Math.sin(m)*(g+i-k)+Math.cos(m)*(h-l)+l,q=Math.sin(m)*(g-k)+Math.cos(m)*(h+j-l)+l;(!this.x||this.x>n)&&(this.x=n),(!this.y||this.y>p)&&(this.y=p),this.width<o&&(this.width=o),this.height<q&&(this.height=q)}this.width-=this.x,this.height-=this.y,this.firstWidth=this.width,this.firstHeight=this.height;for(var d=0,e=a.length;e>d;d++){var f=a[d];f._x?(f.x+=b-this.x,f.y+=c-this.y):(f._x=f.x,f._y=f.y,f.x-=this.x,f.y-=this.y)}return this},release:function(a){var b=this.parent;a.x=a._x,a.y=a._y,a.width=a._width,a.height=a._height,a.rot=a._rot,a._x=null,a._y=null,a._width=null,a._height=null,a._rot=null,a.grouped=!1,a._leave=!1,a.parent=b},remove:function(){for(var a=this.children,b=0,c=a.length;c>b;b++){var d=a[b];this.release(d)}return this.children=[],this._remove=!0,this},_setAbsPos:function(a){var b=this.width/2,c=this.height/2,d=this.rot;a.Cx=this.scaleX*a.x+a._width/2,a.Cy=this.scaleY*a.y+a._height/2,a.startRot=!0;var e=Math.cos(d)*(a.Cx-b)-Math.sin(d)*(a.Cy-c)+b,f=Math.sin(d)*(a.Cx-b)+Math.cos(d)*(a.Cy-c)+c;a._x=e-a._width/2,a._y=f-a._height/2,a._x+=this.x,a._y+=this.y},draw:function(){var a=this.children;this.scaleX=this.width/this.firstWidth,this.scaleY=this.height/this.firstHeight;for(var b=0,c=a.length;c>b;b++){var d=a[b];d._leave?(a.splice(b,1),this.release(d),b--,c--):(d._rot=d.rot+this.rot,d._width=this.scaleX*d.width,d._height=this.scaleY*d.height,this._setAbsPos(d))}}}),window.Atlas=j}();
/**
 * Atlas.js v0.5.9
 * https://github.com/steelydylan/Atlas.js
 * Copyright steelydylan
 * <http://steelydylan.phpapps.jp/>
 * Released under the MIT license.
 */
(function(){var n=[];var d=[];var m=0;var o=(function(){var r=navigator.userAgent;if((r.indexOf("iPhone")>0&&r.indexOf("iPad")==-1)||r.indexOf("iPod")>0||r.indexOf("Android")>0){return true;
}else{return false;}})();var c=(function(t){var s=window.matchMedia("(orientation: portrait)");var r="";if(s.matches){return"portrait";}else{return"landscape";
}})();var q=function(r,u,v){var w=v.which;switch(w){case 13:r.enter=true;u.enter=true;break;case 16:r.shift=true;u.shift=true;break;case 32:r.space=true;
u.space=true;break;case 39:r.right=true;u.right=true;break;case 37:r.left=true;u.left=true;break;case 38:r.up=true;u.up=true;break;case 40:r.down=true;
u.down=true;break;case 8:r.backspace=true;u.backspace=true;break;}for(var s=0;s<26;s++){if(s+65==w){var t=String.fromCharCode(s+97);r[t]=true;u[t]=true;
break;}}};var j=function(r){r.enter=false;r.shift=false;r.space=false;r.right=false;r.left=false;r.up=false;r.down=false;r.backspace=false;for(var s=0;
s<26;s++){r[String.fromCharCode(s+97)]=false;}};var h=(function(){var r=new Object();j(r);return r;})();Atlas=function(){window.App=g;window.Sprite=b;window.Text=e;
window.Shape=i;window.Scene=f;window.Map=a;window.Input=Input;};Atlas.createClass=function(s,u){var t=function(){this.initialize.apply(this,arguments);
};if(typeof s=="function"&&typeof u=="object"){t.prototype=Object.create(s.prototype);t.prototype.inherit=function(){this.initialize=this.superClass.prototype.initialize;
this.superClass=this.superClass.prototype.superClass;if(this.initialize){this.initialize.apply(this,arguments);}};}else{if(typeof s=="object"&&u==null){u=s;
}}for(var r in u){t.prototype[r]=u[r];}t.prototype.superClass=s;return t;};Atlas.extendClass=function(r,t){for(var s in t){if(!r.prototype[s]){r.prototype[s]=t[s];
}}};var p=Atlas.createClass({isMobile:o,orientation:c,initialize:function(){this.eventListener=new Object();this.visible=true;this.eventEnable=false;var r=this.eventListener;
r.touchStart=false;r.touchMove=false;r.touchEnd=false;r.keyUp=false;r.keyDown=false;r.orientationChange=false;},setPosition:function(r,s){this.x=r;this.y=s;
return this;},saveData:function(s){var t=new Object();for(var r in this){if(typeof(this[r])!="function"){t[r]=this[r];}}localStorage.setItem(s,JSON.stringify(t));
},getData:function(s){var t=JSON.parse(localStorage.getItem(s));for(var r in t){this[r]=t[r];}},getTouchPosition:function(w){var v=this.field;var z=parseInt(v.width)/parseInt(v.style.width);
var u=parseInt(v.height)/parseInt(v.style.height);var t=new Object();var s=v.getBoundingClientRect();var r=parseInt(s.left);var A=parseInt(s.top);if(isNaN(r)){r=0;
}if(isNaN(A)){A=0;}if(w){if(!o||(o&&w.touches[0])){t.x=(o?w.touches[0].pageX:w.pageX)-r;t.y=(o?w.touches[0].pageY:w.pageY)-A;}else{t.x=-1;t.y=-1;}}else{t.x=event.x-r;
t.y=event.y-A;}t.x=parseInt(t.x*z);t.y=parseInt(t.y*u);return t;},handleEvent:function(t){if(this.eventEnable){t.preventDefault();var v=this.getTouchPosition(t);
var s=t.type;if(s=="keydown"||s=="keyup"){var u=new Object();for(var r in h){u[r]=h[r];}q(u,h,t);}switch(s){case"touchstart":if(this.touchStart){this.touchStart(v);
}break;case"mousedown":if(this.touchStart){this.touchStart(v);}break;case"touchmove":if(this.touchMove){this.touchMove(v);}break;case"mousemove":if(this.touchMove){this.touchMove(v);
}break;case"touchend":if(this.touchEnd){this.touchEnd();}break;case"mouseup":if(this.touchEnd){this.touchEnd();}break;case"keydown":if(this.keyDown){this.keyDown(h);
}break;case"keyup":if(this.keyUp){this.keyUp(u);}break;}}},useEvent:function(){var s=this.field;var r=this.eventListener;if(this.touchStart&&r.touchStart==false){if(o){s.addEventListener("touchstart",this,false);
}else{s.addEventListener("mousedown",this,false);}r.touchStart=true;}if(this.touchMove&&r.touchMove==false){if(o){s.addEventListener("touchmove",this,false);
}else{s.addEventListener("mousemove",this,false);}r.touchMove=true;}if(this.touchEnd&&r.touchEnd==false){if(o){s.addEventListener("touchend",this,false);
}else{s.addEventListener("mouseup",this,false);}r.touchEnd=true;}if(this.keyUp&&r.keyUp==false){s.addEventListener("keyup",this,false);r.keyUp=true;}if(this.keyDown&&r.keyDown==false){s.addEventListener("keydown",this,false);
r.keyDown=true;}},remove:function(){this._remove=true;},getRand:function(s,r){return ~~(Math.random()*(r-s+1))+s;},getSound:function(r){for(var s=0,t=d.length;
s<t;s++){if(r==d[s].name){this.sound=new Audio(d[s].src);}}},soundClonePlay:function(){var r=this.sound;if(r){(new Audio(r.src)).play();}},soundLoopPlay:function(){var r=this.sound;
if(r){if(!r.loop){r.addEventListener("ended",function(){this.currentTime=0;this.play();},false);}r.loop=true;r.play();}},soundReplay:function(){var r=this.sound;
if(r){r.load();r.play();}},soundStop:function(){var r=this.sound;if(!r.paused){r.pause();r.currentTime=0;}else{r.load();}},soundPlay:function(){var r=this.sound;
if(r){r.play();}},soundPause:function(){var r=this.sound;if(r){r.pause();}},soundGetCount:function(){var r=this.sound;if(r){return r.currentTime;}},soundSetCount:function(s){var r=this.sound;
if(r){r.currentTime=s;}},soundGetVolume:function(){var r=this.sound;if(r){return r.volume;}},soundSetVolume:function(r){var s=this.sound;if(s){s.volume=r;
}},soundGetAlltime:function(){var r=this.sound;if(r){return r.duration;}},soundIsPlaying:function(){var r=this.sound;if(r){return !r.paused;}}});var f=Atlas.createClass(Array,{initialize:function(){this.inherit();
this._remove=false;},addChild:function(r){r.parent=this;if(this.ctx&&this.field){r.ctx=this.ctx;r.field=this.field;}this.push(r);},addChildren:function(){for(var r=0,s=arguments.length;
r<s;r++){this.addChild(arguments[r]);}},getChild:function(s){var t=this.getChildren(s);var r=t[0];if(!r){r=null;}return r;},getChildren:function(v){var s=[];
for(var u=0,w=this.length;u<w;u++){var r=true;for(var t in v){if(v[t]!=this[u][t]){r=false;}}if(r==true){s.push(this[u]);}}return s;},remove:function(){this._remove=true;
},setImage:function(r){this.image=r;},setColor:function(r){this.color=r;},_enterFrame:function(t){if(this.enterFrame){this.enterFrame();}for(var r=0,u=this.length;
r<u;r++){var s=this[r];if(s.useEvent){s.useEvent();}if(s.enterFrame){s.enterFrame();}if(s.tween){s.tween();}if(s.visible){s.draw();}if(s._remove){this.splice(r,1);
delete s;r--;u--;}}}});var g=Atlas.createClass(p,{initialize:function(r){this.inherit();var s=document.createElement("style");s.media="screen";s.type="text/css";
document.getElementsByTagName("head")[0].appendChild(s);var v;if(r){v=document.getElementById(r);}else{v=document.createElement("canvas");var u=document.getElementsByTagName("body").item(0);
u.appendChild(v);}v.width=320;v.height=480;v.style.top=0+"px";v.style.left=0+"px";v.tabIndex="1";document.body.style.margin="0em";var t=navigator.userAgent;
if(o){v.style.width=window.innerWidth+"px";v.style.height=window.innerHeight+"px";v.addEventListener("touchstart",function(){this.focus();});}else{v.style.width=480+"px";
v.style.height=620+"px";v.addEventListener("mousedown",function(){this.focus();});v.addEventListener("keyup",function(){j(h);},false);}this._css=s;this.field=v;
this.ctx=v.getContext("2d");this.fps=30;this.scene=new f();this.scene.parent=this;},colorToAlpha:function(u,t){var r;for(var s=0,v=n.length;s<v;s++){if(n[s].name==u){r=n[s];
r.hex=t;r.index=s;}}r.addEventListener("load",function(){var x=document.createElement("canvas");var I=x.getContext("2d");var w=this.width;var G=this.height;
var F=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;var z=this.hex.replace(F,function(L,N,M,K){return N+N+M+M+K+K;});var J=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(z);
var B=J?{r:parseInt(J[1],16),g:parseInt(J[2],16),b:parseInt(J[3],16)}:null;I.drawImage(this,0,0);var y=I.getImageData(0,0,w,G);var E=y.data;for(var D=0;
D<G;D++){for(var C=0;C<w;C++){var H=D*(w*4)+(C*4);if(E[H]==B.r&&E[H+1]==B.g&&E[H+2]==B.b){E[H+3]=0;}}}I.putImageData(y,0,0);var A=new Image();A.src=x.toDataURL();
n[this.index]=A;});},addChild:function(r){r.ctx=this.ctx;r.field=this.field;r.eventEnable=true;this.scene.addChild(r);},addChildren:function(){for(var r=0,s=arguments.length;
r<s;r++){this.addChild(arguments[r]);}},centerize:function(){var r=this.field.style;r.marginTop=-parseInt(r.height)/2+"px";r.marginLeft=-parseInt(r.width)/2+"px";
r.top="50%";r.left="50%";r.position="absolute";},fitWindow:function(){this.setSize(window.innerWidth,window.innerHeight);var r=this;window.onresize=function(){r.setSize(window.innerWidth,window.innerHeight);
};},setQuality:function(s,r){var t=this.field;t.width=s;t.height=r;},setSize:function(t,r){var s=this.field.style;s.width=t+"px";s.height=r+"px";},loadingScene:function(r){this.preScene=r;
this.preScene.parent=this;},_preLoadEnterFrame:function(){var v=this.field;this.useEvent();var r=this.ctx;r.clearRect(0,0,v.width,v.height);if(m>0&&this.preScene){this.preScene._enterFrame();
}else{if(this.onLoad){this.onLoad();}var t=this.scene;for(var s=0,x=t.length;s<x;s++){var w=t[s];if(w.onLoad){w.onLoad();}}clearInterval(this.preLoadInterval);
var u=this;setInterval(function(){u._enterFrame();},1000/this.fps);}},_enterFrame:function(){var r=this.field;this.ctx.clearRect(0,0,r.width,r.height);
if(this.enterFrame){this.enterFrame();}this.scene._enterFrame();},pushScene:function(w){var z=this.ctx;var y=this.field;var s=this.scene;for(var v=0,t=s.length;
v<t;v++){var x=s[v];x.eventEnable=false;if(x.onSceneremoved){x.onSceneRemoved();}}for(var v=0,t=w.length;v<t;v++){var u=w[v];u.ctx=z;u.field=y;u.eventEnable=true;
if(u.onScenePushed){u.onScenePushed();}}w.parent=this;w.ctx=z;w.field=y;var r=this.field.style;r.background=null;r.backgroundColor="white";if(w.color){this.setColor(w.color);
}if(w.image){this.setImage(w.image);}this.scene=w;},setColor:function(r){var s=this.field.style;s.background=null;s.backgroundColor=r;},setImage:function(r){var s=this.field.style;
s.background="url("+r+") no-repeat center";s.backgroundSize="cover";},start:function(){var s=this.field;var r=this;this.ctx.clearRect(0,0,s.width,s.height);
this.preLoadInterval=setInterval(function(){r._preLoadEnterFrame();},1000/this.fps);},load:function(){function t(D){var B;if(!D){return B;}var C=D.split(".");
var A=C.length;if(A===0){return B;}B=C[A-1];return B;}for(var x=0,u=arguments.length;x<u;x++){var v=arguments[x];if(v instanceof Array){var w=v[0];var r=v[1];
}else{var w=v;var r=v;}var s=t(w);if(s=="wav"||s=="mp3"||s=="ogg"){var v=new Audio(w);v.name=r;m++;v.addEventListener("canplaythrough",function(){m--;console.log(this.src+" is loaded");
});d.push(v);}else{if(s=="TTF"||s=="ttf"){var y=this._css;var z=document.createTextNode("@font-face{font-family:'"+r+"';src: url('"+w+"') format('truetype');}");
if(y.styleSheet){y.styleSheet.cssText=z;}else{y.appendChild(z);}}else{var v=new Image();v.src=w;v.name=r;m++;v.addEventListener("load",function(){m--;console.log(this.src+" is loaded");
});n.push(v);}}}},});var l=function(t,s,w){var r=t.mover;var v=r[r.length-1];if(v&&v.and){var u=v;}else{var u=new Object();r.push(u);}u.time=0;if(w){u.frame=w;
}u.loop=false;u.and=false;u[s]=true;return u;};var k=Atlas.createClass(p,{initialize:function(s,r){this.inherit();this.x=0;this.y=0;this.rot=0;this._remove=false;
this.width=s;this.height=r;this.collisionShape="box";this.mover=[];this.moverIndex=0;this.alpha=1;this.field;},tween:function(){var r=this.mover;var s=r.length;
if(this.moverIndex<s){var t=r[this.moverIndex];if(t.animate){this._animate(t);}if(t.moveTo){this._moveTo(t);}if(t.moveBy){this._moveBy(t);}if(t.rotateBy){this._rotateBy(t);
}if(t.scaleBy){this._scaleBy(t);}if(t.then){this._then(t);}t.time++;if(t.time>t.frame){this.moverIndex++;if(this.moverIndex==s){if(t.loop){this._refresh();
}else{this.stop();}}}}},isQueEmpty:function(){return this.mover.length?false:true;},animate:function(u,r,t){var s=l(this,"animate",t);s.array=u;s.frameRate=r;
s.frameIdx=0;return this;},_animate:function(r){if(r.time==0){this.frame=r.array[0];}if(r.time%r.frameRate==0){r.frameIdx=(r.frameIdx+1)%r.array.length;
this.frame=r.array[r.frameIdx];}},_refresh:function(){this.moverIndex=0;var r=this.mover;for(var s=0,u=r.length;s<u;s++){var t=r[s];if(t.time){t.time=0;
}}},moveTo:function(r,u,t){var s=l(this,"moveTo",t);s.toX=r;s.toY=u;return this;},_moveTo:function(r){if(r.time==0){r.diffX=r.toX-this.x;r.diffY=r.toY-this.y;
}this.x=r.toX-r.diffX*(1-r.time/r.frame);this.y=r.toY-r.diffY*(1-r.time/r.frame);},moveBy:function(r,u,t){var s=l(this,"moveBy",t);s.diffX=r;s.diffY=u;
return this;},_moveBy:function(r){if(r.time==0){r.toX=this.x+r.diffX;r.toY=this.y+r.diffY;}this.x=r.toX-r.diffX*(1-r.time/r.frame);this.y=r.toY-r.diffY*(1-r.time/r.frame);
},scaleBy:function(r,u,t){var s=l(this,"scaleBy",t);s.scaleX=r;s.scaleY=u;return this;},_scaleBy:function(r){if(r.time==0){r.toWidth=this.width*r.scaleX;
r.toHeight=this.height*r.scaleY;r.diffWidth=r.toWidth-this.width;r.diffHeight=r.toHeight-this.height;}this.width=r.toWidth-r.diffWidth*(1-r.time/r.frame);
this.height=r.toHeight-r.diffHeight*(1-r.time/r.frame);},delay:function(s){var r=l(this,"delay",s);this.mover.push(r);return this;},and:function(){var r=this.mover;
var s=r[r.length-1];if(s){s.and=true;}return this;},stop:function(){this.mover=[];this.moverIndex=0;return this;},loop:function(){var r=this.mover[this.mover.length-1];
r.loop=true;return this;},rotateBy:function(t,s){var r=l(this,"rotateBy",s);r.diffAngle=t;return this;},_rotateBy:function(r){if(r.time==0){r.toAngle=this.rot+r.diffAngle;
}this.rot=r.toAngle-r.diffAngle*(1-r.time/r.frame);},then:function(r,t){var s=l(this,"then",t);s.exec=r;return this;},_then:function(r){r.exec.call(this);
},intersect:function(A,w){if(this.collisionShape=="box"){var D=A-(this.x+this.width/2);var C=w-(this.y+this.height/2);var u=this.rot;var E=Math.sin(-u);
var B=Math.cos(-u);var t=Math.abs(D*B-C*E);var z=Math.abs(D*E+C*B);if(t<this.width/2&&z<this.height/2){return true;}return false;}else{if(this.collisionShape=="circle"){var v=this.width/2;
var D=A-(this.x+v);var C=w-(this.y+v);if(Math.sqrt(D*D+C*C)<v){return true;}return false;}else{return false;}}},within:function(B,w){if(this.collisionShape=="box"){var H=this.x+this.width/2;
var G=this.y+this.height/2;}else{if(this.collisionShape=="circle"){var A=this.width/2;var H=this.x+A;var G=this.y+A;}else{return false;}}if(B.collisionShape=="box"){var v=B.x+B.width/2;
var u=B.y+B.height/2;var r=-B.rot;var t=Math.cos(r)*(H-v)-Math.sin(r)*(G-u)+v;var s=Math.sin(r)*(H-v)+Math.cos(r)*(G-u)+u;var F,D;if(t<B.x){F=B.x;}else{if(t>B.x+B.width){F=B.x+B.width;
}else{F=t;}}if(s<B.y){D=B.y;}else{if(s>B.y+B.height){D=B.y+B.height;}else{D=s;}}var E=Math.abs(t-F);var C=Math.abs(s-D);}else{if(B.collisionShape=="circle"){var z=B.width/2;
var F=B.x+z;var D=B.y+z;var E=Math.abs(H-F);var C=Math.abs(G-D);w+=z;}else{return false;}}if(Math.sqrt((E*E)+(C*C))<w){return true;}return false;},scale:function(s,r){this.width*=s;
this.height*=r;return this;}});var i=new Object();i.Box=Atlas.createClass(k,{initialize:function(s,t,r){this.inherit(t,r);this.color=s;},draw:function(){var r=this.ctx;
r.globalAlpha=this.alpha;r.beginPath();r.fillStyle=this.color;var t=this.x+this.width/2;var s=this.y+this.height/2;r.save();r.translate(t,s);r.rotate(this.rot);
r.translate(-t,-s);r.fillRect(this.x,this.y,this.width,this.height);r.restore();r.globalAlpha=1;}});i.Circle=Atlas.createClass(k,{initialize:function(s,r){this.inherit(r*2,0);
this.color=s;this.collisionShape="circle";},draw:function(){var r=this.ctx;r.globalAlpha=this.alpha;r.beginPath();r.fillStyle=this.color;var s=this.width/2;
r.arc(this.x+s,this.y+s,s,0,Math.PI*2,false);r.fill();r.globalAlpha=1;}});var b=Atlas.createClass(k,{initialize:function(s,t,r){this.inherit(t,r);this.setImage(s,t,r);
this.frame=0;},setSpriteSize:function(s,r){this.spriteWidth=s;this.spriteHeight=r;},setImage:function(s,u,r){if(u&&r){this.setSpriteSize(u,r);}var v=n.length;
for(var t=0;t<v;t++){if(n[t].name==s){this.img=t;}}},getImage:function(){return n[this.img];},draw:function(){var B=this.ctx;var r=this.frame;var s=n[this.img];
var A=this.spriteWidth;var x=this.spriteHeight;var u=this.width/2;var t=this.height/2;var D=s.width/A;var z=s.height/x;var w=this.width/A;var v=this.height/x;
var C=(r%D)*A;var y=(~~(r/D)%z)*x;B.save();B.translate(this.x+u,this.y+t);B.rotate(this.rot);B.translate(-u,-t);B.scale(w,v);if(C!=null){B.drawImage(s,C,y,A,x,0,0,A,x);
}B.restore();}});var a=Atlas.createClass(b,{initialize:function(s,t,r){this.inherit(s,t,r);this.drawData;this.hitData;},intersect:function(A,z){var w=this.hitData;
var C=w[0].length;var B=w.length;var u=this.width;var D=this.height;var s=this.x;var r=this.y;for(var v=0;v<B;v++){for(var E=0;E<C;E++){if(w[v][E]==1&&s+E*u<A&&A<s+(E+1)*u&&r+v*D<z&&z<r+(v+1)*D){return true;
}}}return false;},draw:function(){var z=this.drawData;var B=z[0].length;var A=z.length;var K=this.width;var I=this.height;var H=this.x;var G=this.y;var M=0;
var E=0;var r=this.field;var L=this.ctx;var s=r.height;var v=r.width;var F;var J=n[this.img];var Q=this.spriteWidth;var P=this.spriteHeight;var O=this.width/2;
var N=this.height/2;var w=J.width/Q;var u=J.height/P;var S=this.width/Q;var R=this.height/P;var D=(F%w)*Q;var C=(~~(F/w)%u)*P;while(M<A){while(E<B){F=z[M][E];
if(F>=0&&s>G+I*M&&G+I*(M+1)>0&&v>H+K*E&&H+K*(E+1)>0){var D=(F%w)*Q;var C=(~~(F/w)%u)*P;L.save();L.translate(this.x,this.y);L.scale(S,R);L.drawImage(J,D,C,Q,P,0,0,Q,P);
L.restore();}this.x+=K;E++;}this.y+=I;M++;this.x=H;E=0;}this.x=H;this.y=G;}});var e=Atlas.createClass(p,{initialize:function(t,s,u,r){this.inherit();this.x=0;
this.y=0;this.alpha=1;this.spaceWidth=0;if(r){this.font="'"+r+"'";}else{this.font="'Meiryo'";}if(u){this.size=u+"px";}else{this.size="10px";}if(t){this.string=t;
}else{this.string="";}if(s){this.color=s;}else{this.color="white";}},setSize:function(r){this.size=r+"px";},setFont:function(r){this.font="'"+r+"'";},intersect:function(s,v){var t=this.ctx;
t.font=this.font;var u=t.measureText(this.string).width;var r=t.measureText("m").width*1.5;if(s>this.x&&s<this.x+u&&v>this.y-r&&v<this.y){return true;}else{return false;
}},draw:function(){var t=this.x;var z=this.y;var u=this.ctx;var s=this.string.split("<br>");var w=s.length;u.globalAlpha=this.alpha;u.font=this.size+" "+this.font;
u.fillStyle=this.color;var r=u.measureText("a").width*1.5+this.spaceWidth;for(var v=0;v<w;v++){u.fillText(s[v],t,z+r);z+=r;}u.globalAlpha=1;}});Input=Atlas.createClass(e,{initialize:function(x,v,r,t,s){this.inherit("",t,r-5,s);
this.box=new Atlas.Sprite(x);this.box.width=v;this.box.height=r;var u=document.createElement("input");u.style.position="absolute";u.style.zIndex=-1;u.parent=this;
var w=document.getElementsByTagName("body").item(0);w.appendChild(u);this.element=u;u.addEventListener("input",function(){var A=this.parent;var y=A.ctx;
var z=this.value;while(y.measureText(z).width>A.box.width){z=z.slice(1,z.length);}A.string=z;});},onLoad:function(){this.element.style.top=this.field.style.top;
this.element.style.left=this.field.style.left;this.element.style.marginTop=this.field.style.marginTop;this.element.style.marginLeft=this.field.style.marginLeft;
var s=this.box;var r=s.getImage();s.setSpriteSize(r.width,r.height);s.field=this.field;s.ctx=this.ctx;s.setPosition(this.x,this.y);this.parent.addChild(s);
},enterFrame:function(){var r=this.box;r.setPosition(this.x,this.y);},touchStart:function(r){if(this.box.intersect(r.x,r.y)){this.element.focus();}},getValue:function(){return this.element.value;
}});Atlas.App=g;Atlas.Sprite=b;Atlas.Shape=i;Atlas.Map=a;Atlas.Text=e;Atlas.Scene=f;Atlas.Input=Input;})();
/**
 * Atlas.js v0.6.8
 * https://github.com/steelydylan/Atlas.js
 * Copyright steelydylan
 * <http://steelydylan.webcrow.jp/>
 * Released under the MIT license.
 */
(function(){var g=[];var i=[];var s=0;var l=(function(){var u=navigator.userAgent;if((u.indexOf("iPhone")>0&&u.indexOf("iPad")==-1)||u.indexOf("iPod")>0||u.indexOf("Android")>0){return true}else{return false}})();var b=(function(w){var v=window.matchMedia("(orientation: portrait)");var u="";if(v.matches){return"portrait"}else{return"landscape"}})();var f=function(u,x,y){var z=y.which;switch(z){case 13:u.enter=true;x.enter=true;break;case 16:u.shift=true;x.shift=true;break;case 32:u.space=true;x.space=true;break;case 39:u.right=true;x.right=true;break;case 37:u.left=true;x.left=true;break;case 38:u.up=true;x.up=true;break;case 40:u.down=true;x.down=true;break;case 8:u.backspace=true;x.backspace=true;break}for(var v=0;v<26;v++){if(v+65==z){var w=String.fromCharCode(v+97);u[w]=true;x[w]=true;break}}};var t=function(u){u.enter=false;u.shift=false;u.space=false;u.right=false;u.left=false;u.up=false;u.down=false;u.backspace=false;for(var v=0;v<26;v++){u[String.fromCharCode(v+97)]=false}};var k=(function(){var u=new Object();t(u);return u})();var o=function(){for(var u in o){window[u]=o[u]}};o.createClass=function(v,x){var w=function(){this.initialize.apply(this,arguments)};if(typeof v=="function"&&typeof x=="object"){w.prototype=Object.create(v.prototype);w.prototype.inherit=function(){this.initialize=this.superClass.prototype.initialize;this.superClass=this.superClass.prototype.superClass;if(this.initialize){this.initialize.apply(this,arguments)}}}else{if(typeof v=="object"&&x==null){x=v}}for(var u in x){w.prototype[u]=x[u]}w.prototype.superClass=v;return w};o.extendClass=function(u,w){for(var v in w){u.prototype[v]=w[v]}};var h=function(w,v,z){var u=w.mover;var y=u[u.length-1];if(y&&y.and){var x=y}else{var x=new Object();u.push(x)}x.time=0;if(z){x.frame=z}x.loop=false;x.and=false;x[v]=true;return x};var d=o.createClass({isMobile:l,orientation:b,initialize:function(){this.eventListener=new Object();this.mover=[];this.rot=0;this.moverIndex=0;this.visible=true;this.eventEnable=true;this.drawMode="source-over";var u=this.eventListener;u.touchStart=false;u.touchMove=false;u.touchEnd=false;u.keyUp=false;u.keyDown=false;u.multiTouchStart=false;u.multiTouchMove=false;u.multiTouchEnd=false;u.orientationChange=false},tween:function(){var u=this.mover;var v=u.length;if(this.moverIndex<v){var w=u[this.moverIndex];if(w.animate){this._animate(w)}if(w.moveTo){this._moveTo(w)}if(w.moveBy){this._moveBy(w)}if(w.rotateBy){this._rotateBy(w)}if(w.scaleBy){this._scaleBy(w)}if(w.then){this._then(w)}w.time++;if(w.time>w.frame){this.moverIndex++;if(this.moverIndex==v){if(w.loop){this._refresh()}else{this.stop()}}}}},isQueEmpty:function(){return this.mover.length?false:true},_refresh:function(){this.moverIndex=0;var u=this.mover;for(var v=0,x=u.length;v<x;v++){var w=u[v];if(w.time){w.time=0}}},moveTo:function(u,z,w){var v=h(this,"moveTo",w);v.toX=u;v.toY=z;return this},_moveTo:function(u){if(u.time==0){u.diffX=u.toX-this.x;u.diffY=u.toY-this.y}this.x=u.toX-u.diffX*(1-u.time/u.frame);this.y=u.toY-u.diffY*(1-u.time/u.frame)},moveBy:function(u,z,w){var v=h(this,"moveBy",w);v.diffX=u;v.diffY=z;return this},_moveBy:function(u){if(u.time==0){u.toX=this.x+u.diffX;u.toY=this.y+u.diffY}this.x=u.toX-u.diffX*(1-u.time/u.frame);this.y=u.toY-u.diffY*(1-u.time/u.frame)},delay:function(v){var u=h(this,"delay",v);this.mover.push(u);return this},and:function(){var u=this.mover;var v=u[u.length-1];if(v){v.and=true}return this},stop:function(){this.mover=[];this.moverIndex=0;return this},loop:function(){var u=this.mover[this.mover.length-1];u.loop=true;return this},rotateBy:function(w,v){var u=h(this,"rotateBy",v);u.diffAngle=w;return this},_rotateBy:function(u){if(u.time==0){u.toAngle=this.rot+u.diffAngle}this.rot=u.toAngle-u.diffAngle*(1-u.time/u.frame)},then:function(u,w){var v=h(this,"then",w);v.exec=u;return this},_then:function(u){u.exec.call(this)},scaleBy:function(u,z,w){var v=h(this,"scaleBy",w);v.scaleX=u;v.scaleY=z;return this},setPosition:function(u,v){this.x=u;this.y=v;return this},saveData:function(v){var w=new Object();for(var u in this){if(typeof(this[u])!="function"){w[u]=this[u]}}localStorage.setItem(v,JSON.stringify(w))},getData:function(v){var w=JSON.parse(localStorage.getItem(v));for(var u in w){this[u]=w[u]}},getTouchPosition:function(A,z){if(!(z&&A.touches[z])){z=0}var C=this.field;var u=parseInt(C.width)/parseInt(C.style.width);var G=parseInt(C.height)/parseInt(C.style.height);var w=new Object();var v=C.getBoundingClientRect();var D=parseInt(v.left);var B=parseInt(v.top);if(isNaN(D)){D=0}if(isNaN(B)){B=0}var F=document.documentElement.scrollLeft||document.body.scrollLeft;var E=document.documentElement.scrollTop||document.body.scrollTop;if(A){if(!l||(l&&A.touches[z])){w.x=(l?A.touches[z].pageX:A.pageX)-D-F;w.y=(l?A.touches[z].pageY:A.pageY)-B-E}else{w.x=-1;w.y=-1}}else{w.x=event.x-D;w.y=event.y-B}w.x=parseInt(w.x*u);w.y=parseInt(w.y*G);return w},getMultiTouchPosition:function(w){var v=w.touches.length;var x=[];for(var u=0;u<v;u++){x[u]=this.getTouchPosition(w,u)}return x},handleEvent:function(w){if(this.eventEnable){w.preventDefault();var y=this.getTouchPosition(w);if(w.touches){y.touchCount=w.touches.length}else{y.touchCount=1}y.event=w;var v=w.type;if(v=="keydown"||v=="keyup"){var x=new Object();for(var u in k){x[u]=k[u]}f(x,k,w)}switch(v){case"touchstart":if(this.multiTouchStart&&w.touches.length>1){this.multiTouchStart(this.getMultiTouchPosition(w))}else{if(this.touchStart){this.touchStart(y)}}break;case"mousedown":if(this.touchStart){this.touchStart(y)}break;case"touchmove":if(this.multiTouchMove&&w.touches.length>1){this.multiTouchMove(this.getMultiTouchPosition(w))}else{if(this.touchMove){this.touchMove(y)}}break;case"mousemove":if(this.touchMove){this.touchMove(y)}break;case"touchend":if(this.multiTouchEnd&&w.touches.length>1){this.multiTouchEnd(this.getMultiTouchPosition(w))}else{if(this.touchEnd){this.touchEnd(y)}}break;case"mouseup":if(this.touchEnd){this.touchEnd()}break;case"keydown":if(this.keyDown){this.keyDown(k)}break;case"keyup":if(this.keyUp){this.keyUp(x)}break}}},useEvent:function(){var v=this.field;var u=this.eventListener;if(this.touchStart&&u.touchStart==false){if(l){v.addEventListener("touchstart",this,false)}else{v.addEventListener("mousedown",this,false)}u.touchStart=true}if(this.touchMove&&u.touchMove==false){if(l){v.addEventListener("touchmove",this,false)}else{v.addEventListener("mousemove",this,false)}u.touchMove=true}if(this.touchEnd&&u.touchEnd==false){if(l){v.addEventListener("touchend",this,false)}else{v.addEventListener("mouseup",this,false)}u.touchEnd=true}if(this.multiTouchStart&&u.multiTouchStart==false){if(!u.touchStart){if(l){v.addEventListener("touchstart",this,false)}else{v.addEventListener("mousedown",this,false)}}u.touchStart=true}if(this.multiTouchMove&&u.multiTouchMove==false){if(!u.touchMove){if(l){v.addEventListener("touchmove",this,false)}else{v.addEventListener("mousemove",this,false)}}u.touchMove=true}if(this.multiTouchEnd&&u.multiTouchEnd==false){if(!u.touchEnd){if(l){v.addEventListener("touchend",this,false)}else{v.addEventListener("mouseup",this,false)}}u.touchEnd=true}if(this.keyUp&&u.keyUp==false){v.addEventListener("keyup",this,false);u.keyUp=true}if(this.keyDown&&u.keyDown==false){v.addEventListener("keydown",this,false);u.keyDown=true}},remove:function(){this._remove=true},getRand:function(v,u){return ~~(Math.random()*(u-v+1))+v},getSound:function(u){for(var v=0,w=i.length;v<w;v++){if(u==i[v].name){this.sound=new Audio(i[v].src)}}},soundClonePlay:function(){var u=this.sound;if(u){(new Audio(u.src)).play()}},soundLoopPlay:function(){var u=this.sound;if(u){if(!u.loop){u.addEventListener("ended",function(){this.currentTime=0;this.play()},false)}u.loop=true;u.play()}},soundReplay:function(){var u=this.sound;if(u){u.load();u.play()}},soundStop:function(){var u=this.sound;if(!u.paused){u.pause();u.currentTime=0}else{u.load()}},soundPlay:function(){var u=this.sound;if(u){u.play()}},soundPause:function(){var u=this.sound;if(u){u.pause()}},soundGetCount:function(){var u=this.sound;if(u){return u.currentTime}},soundSetCount:function(v){var u=this.sound;if(u){u.currentTime=v}},soundGetVolume:function(){var u=this.sound;if(u){return u.volume}},soundSetVolume:function(u){var v=this.sound;if(v){v.volume=u}},soundGetAlltime:function(){var u=this.sound;if(u){return u.duration}},soundIsPlaying:function(){var u=this.sound;if(u){return !u.paused}}});var a=o.createClass(Array,{initialize:function(){this.inherit();this._basicConstructor="Scene";this._remove=false},addChild:function(w){w.parent=this;if(w.children){var v=w.children;for(var u=0,y=v.length;u<y;u++){var x=v[u];x.ctx=this.ctx;x.field=this.field}}if(this.ctx&&this.field){w.ctx=this.ctx;w.field=this.field}this.push(w)},addChildren:function(){for(var u=0,v=arguments.length;u<v;u++){this.addChild(arguments[u])}},getChild:function(v){var w=this.getChildren(v);var u=w[0];if(!u){u=null}return u},getChildren:function(y){var v=[];for(var x=0,z=this.length;x<z;x++){var u=true;for(var w in y){if(y[w]!=this[x][w]){u=false}}if(u==true){v.push(this[x])}}return v},remove:function(){this._remove=true},setImage:function(u){this.image=u},setColor:function(u){this.color=u},_enterFrame:function(x){if(this.enterFrame){this.enterFrame()}for(var u=0,y=this.length;u<y;u++){var w=this[u];if(w._basicConstructor=="Sprite"&&!w.spriteWidth){var v=w.getImageSize();if(v.width){w.setSpriteSize(v.width,v.height);if(!w.width){w.setSize(v.width,v.height);if(w._scaleX){w.scale(w._scaleX,w._scaleY)}}}}if(w.useEvent){w.useEvent()}if(w.enterFrame){w.enterFrame()}if(w.tween){w.tween()}if(w.visible){if(w.preDraw){w.preDraw()}w.draw()}if(w._remove){this.splice(u,1);w=null;u--;y--}}}});var p=o.createClass(d,{initialize:function(u){this.inherit();this._basicConstructor="App";var v=document.createElement("style");v.media="screen";v.type="text/css";document.getElementsByTagName("head")[0].appendChild(v);var y;if(u){y=document.getElementById(u)}else{y=document.createElement("canvas");var x=document.getElementsByTagName("body").item(0);x.appendChild(y)}y.width=320;y.height=480;y.style.top=0+"px";y.style.left=0+"px";y.tabIndex="1";document.body.style.margin="0em";var w=navigator.userAgent;if(l){y.style.width=window.innerWidth+"px";y.style.height=window.innerHeight+"px";y.addEventListener("touchstart",function(){this.focus()})}else{y.style.width=480+"px";y.style.height=620+"px";y.addEventListener("mousedown",function(){this.focus()});y.addEventListener("keyup",function(){t(k)},false)}this._css=v;this.field=y;this.ctx=y.getContext("2d");this.fps=30;this.scene=new a();this.scene.ctx=this.ctx;this.scene.field=this.field;this.scene.parent=this},colorToAlpha:function(x,w){var u;for(var v=0,y=g.length;v<y;v++){if(g[v].name==x){u=g[v];u.hex=w;u.index=v}}u.addEventListener("load",function(){var A=document.createElement("canvas");var L=A.getContext("2d");var z=this.width;var J=this.height;var I=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;var C=this.hex.replace(I,function(O,Q,P,N){return Q+Q+P+P+N+N});var M=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(C);var E=M?{r:parseInt(M[1],16),g:parseInt(M[2],16),b:parseInt(M[3],16)}:null;L.drawImage(this,0,0);var B=L.getImageData(0,0,z,J);var H=B.data;for(var G=0;G<J;G++){for(var F=0;F<z;F++){var K=G*(z*4)+(F*4);if(H[K]==E.r&&H[K+1]==E.g&&H[K+2]==E.b){H[K+3]=0}}}L.putImageData(B,0,0);var D=new Image();D.src=A.toDataURL();g[this.index]=D})},addChild:function(u){u.ctx=this.ctx;u.field=this.field;this.scene.addChild(u)},addChildren:function(){for(var u=0,v=arguments.length;u<v;u++){this.addChild(arguments[u])}},centerize:function(){var u=this.field.style;u.marginTop=-parseInt(u.height)/2+"px";u.marginLeft=-parseInt(u.width)/2+"px";u.top="50%";u.left="50%";u.position="absolute"},fitWindow:function(){this.setSize(window.innerWidth,window.innerHeight);var u=this;window.onresize=function(){u.setSize(window.innerWidth,window.innerHeight)}},setQuality:function(v,u){var w=this.field;w.width=v;w.height=u},setSize:function(w,u){var v=this.field.style;v.width=w+"px";v.height=u+"px"},getSize:function(){var u=new Object();u.width=parseInt(this.field.style.width);u.height=parseInt(this.field.style.height);return u},getQuality:function(){var u=new Object();u.width=parseInt(this.field.width);u.height=parseInt(this.field.height);return u},loadingScene:function(u){this.preScene=u;this.preScene.parent=this},_preLoadEnterFrame:function(){var y=this.field;this.useEvent();var u=this.ctx;u.clearRect(0,0,y.width,y.height);if(s>0&&this.preScene){this.preScene._enterFrame()}else{if(this.onLoad){this.onLoad()}var w=this.scene;for(var v=0,A=w.length;v<A;v++){var z=w[v];if(z.onLoad){z.onLoad()}}clearInterval(this.preLoadInterval);var x=this;setInterval(function(){x._enterFrame()},1000/this.fps)}},_enterFrame:function(){var u=this.field;this.ctx.clearRect(0,0,u.width,u.height);this.useEvent();if(this.enterFrame){this.enterFrame()}this.scene._enterFrame()},pushScene:function(z){var C=this.ctx;var B=this.field;var v=this.scene;for(var y=0,w=v.length;y<w;y++){var A=v[y];A.eventEnable=false;if(A.onSceneremoved){A.onSceneRemoved()}}for(var y=0,w=z.length;y<w;y++){var x=z[y];x.ctx=C;x.field=B;x.eventEnable=true;if(x.onScenePushed){x.onScenePushed()}}z.parent=this;z.ctx=C;z.field=B;var u=this.field.style;u.background=null;u.backgroundColor="white";if(z.color){this.setColor(z.color)}if(z.image){this.setImage(z.image)}this.scene=z},setColor:function(u){var v=this.field.style;v.background=null;v.backgroundColor=u},setImage:function(u){var v=this.field.style;v.background="url("+u+") no-repeat center";v.backgroundSize="cover"},start:function(){var v=this.field;var u=this;this.ctx.clearRect(0,0,v.width,v.height);this.preLoadInterval=setInterval(function(){u._preLoadEnterFrame()},1000/this.fps)},toDataURL:function(){return this.field.toDataURL()},load:function(){function w(G){var E;if(!G){return E}var F=G.split(".");var D=F.length;if(D===0){return E}E=F[D-1];return E}for(var A=0,x=arguments.length;A<x;A++){var y=arguments[A];if(y instanceof Array){var z=y[0];var u=y[1]}else{var z=y;var u=y}var v=w(z);if(v=="wav"||v=="mp3"||v=="ogg"){var y=new Audio(z);y.name=u;s++;y.addEventListener("canplaythrough",function(){s--;console.log(this.src+" is loaded")});i.push(y)}else{if(v=="TTF"||v=="ttf"){var B=this._css;var C=document.createTextNode("@font-face{font-family:'"+u+"';src: url('"+z+"') format('truetype');}");if(B.styleSheet){B.styleSheet.cssText=C}else{B.appendChild(C)}}else{var y=new Image();y.src=z;y.name=u;s++;y.addEventListener("load",function(){s--;console.log(this.src+" is loaded")});g.push(y)}}}},});var n=o.createClass(d,{initialize:function(v,u){this.inherit();this.x=0;this.y=0;this._remove=false;this.width=v;this.height=u;this.collisionShape="box";this.alpha=1;this.field},_scaleBy:function(u){if(u.time==0){u.toWidth=this.width*u.scaleX;u.toHeight=this.height*u.scaleY;u.diffWidth=u.toWidth-this.width;u.diffHeight=u.toHeight-this.height}this.width=u.toWidth-u.diffWidth*(1-u.time/u.frame);this.height=u.toHeight-u.diffHeight*(1-u.time/u.frame)},intersect:function(D,B){var z=this.x;var w=this.y;if(this.parent.className=="Group"){z+=this.parent.x;w+=this.parent.y}if(this.collisionShape=="box"){var G=D-(z+this.width/2);var F=B-(w+this.height/2);var v=this.rot;var H=Math.sin(-v);var E=Math.cos(-v);var u=Math.abs(G*E-F*H);var C=Math.abs(G*H+F*E);if(u<this.width/2&&C<this.height/2){return true}return false}else{if(this.collisionShape=="circle"){var A=this.width/2;var G=D-(z+A);var F=B-(w+A);if(Math.sqrt(G*G+F*F)<A){return true}return false}else{return false}}},hitTest:function(D){if(this.collisionShape=="box"){if(D.collisionShape=="circle"){return D.within(this,D.width/2)}}else{if(this.collisionShape=="circle"){return this.within(D,this.width/2)}else{return false}}var A=this.x;var y=this.y;var G=this.width;var C=this.height;var H=A+this.width/2;var F=y+this.height/2;var x=D.x;var v=D.y;var E=D.width;var B=D.height;if(this.parent._basicConstructor=="Group"){A+=this.parent.x;y+=this.parent.y}if(D.rot!=0&&D.rot!=Math.PI){if(D.collisionShape=="box"){var z=x+E/2;var w=v+B/2;var H=A+G/2;var F=y+C/2;var u=-D.rot;H=Math.cos(u)*(H-z)-Math.sin(u)*(F-w)+z;F=Math.sin(u)*(H-z)+Math.cos(u)*(F-w)+w;A=H-G/2;y=F-C/2}}return(A<x+E)&&(x<A+G)&&(y<v+B)&&(v<y+C)},within:function(G,D){var C=this.x;var A=this.y;if(this.parent._basicConstructor=="Group"){C+=this.parent.x;A+=this.parent.y}if(this.collisionShape=="box"){var M=C+this.width/2;var L=A+this.height/2}else{if(this.collisionShape=="circle"){var F=this.width/2;var M=C+F;var L=A+F}else{return false}}if(G.collisionShape=="box"){var B=G.x+G.width/2;var z=G.y+G.height/2;var u=-G.rot;var w=Math.cos(u)*(M-B)-Math.sin(u)*(L-z)+B;var v=Math.sin(u)*(M-B)+Math.cos(u)*(L-z)+z;var K,I;if(w<G.x){K=G.x}else{if(w>G.x+G.width){K=G.x+G.width}else{K=w}}if(v<G.y){I=G.y}else{if(v>G.y+G.height){I=G.y+G.height}else{I=v}}var J=Math.abs(w-K);var H=Math.abs(v-I)}else{if(G.collisionShape=="circle"){var E=G.width/2;var K=G.x+E;var I=G.y+E;var J=Math.abs(M-K);var H=Math.abs(L-I);D+=E}else{return false}}if(Math.sqrt((J*J)+(H*H))<D){return true}return false},scale:function(v,u){if(!this.width){this._scaleX=v;this._scaleY=u}else{this.width*=v;this.height*=u}return this},setSize:function(u,v){this.width=u;this.height=v}});var e=new Object();e.Box=o.createClass(n,{initialize:function(v,w,u){this.inherit(w,u);this._basicConstructor="Shape";this.color=v},draw:function(){var u=this.ctx;u.globalAlpha=this.alpha;u.globalCompositeOperation=this.drawMode;u.beginPath();u.fillStyle=this.color;var w=this.x+this.width/2;var v=this.y+this.height/2;u.save();u.translate(w,v);u.rotate(this.rot);u.translate(-w,-v);u.fillRect(this.x,this.y,this.width,this.height);u.restore();u.globalAlpha=1}});e.Circle=o.createClass(n,{initialize:function(v,u){this.inherit(u*2,0);this._basicConstructor="Shape";this.color=v;this.collisionShape="circle"},draw:function(){var u=this.ctx;u.globalAlpha=this.alpha;u.globalCompositeOperation=this.drawMode;u.beginPath();u.fillStyle=this.color;var v=this.width/2;u.arc(this.x+v,this.y+v,v,0,Math.PI*2,false);u.fill();u.globalAlpha=1}});var j=o.createClass(n,{initialize:function(v,w,u){if(typeof w==="undefined"){w=null;u=null}this.inherit(w,u);this.setImage(v,w,u);this._basicConstructor="Sprite";this.frame=0;this.alpha=1},animate:function(x,u,w){var v=h(this,"animate",w);v.array=x;v.frameRate=u;v.frameIdx=0;return this},_animate:function(u){if(u.time==0){this.frame=u.array[0]}if(u.time%u.frameRate==0){u.frameIdx=(u.frameIdx+1)%u.array.length;this.frame=u.array[u.frameIdx]}},setSpriteSize:function(v,u){this.spriteWidth=v;this.spriteHeight=u},setImage:function(v,x,u){if(x&&u){this.setSpriteSize(x,u)}var y=g.length;for(var w=0;w<y;w++){if(g[w].name==v){this.img=w}}},getImage:function(){return g[this.img]},getImageSize:function(){var v={};var u=g[this.img];v.width=u.width;v.height=u.height;return v},draw:function(){var E=this.ctx;E.globalAlpha=this.alpha;E.globalCompositeOperation=this.drawMode;var u=this.frame;var v=g[this.img];var D=this.spriteWidth;var A=this.spriteHeight;var x=this.width/2;var w=this.height/2;var G=v.width/D;var C=v.height/A;var z=this.width/D;var y=this.height/A;var F=(u%G)*D;var B=(~~(u/G)%C)*A;E.save();E.translate(this.x+x,this.y+w);E.rotate(this.rot);E.translate(-x,-w);E.scale(z,y);if(F!=null){E.drawImage(v,F,B,D,A,0,0,D,A)}E.restore();E.globalAlpha=1}});var c=o.createClass(j,{initialize:function(v,w,u){this.inherit(v,w,u);this.drawData;this.hitData},intersect:function(C,B){var A=this.hitData;var E=A[0].length;var D=A.length;var w=this.width;var F=this.height;var v=this.x;var u=this.y;for(var z=0;z<D;z++){for(var G=0;G<E;G++){if(A[z][G]==1&&v+G*w<C&&C<v+(G+1)*w&&u+z*F<B&&B<u+(z+1)*F){return true}}}return false},draw:function(){var B=this.drawData;var D=B[0].length;var C=B.length;var M=this.width;var K=this.height;var J=this.x;var I=this.y;var O=0;var G=0;var u=this.field;var N=this.ctx;N.globalAlpha=this.alpha;N.globalCompositeOperation=this.drawMode;var v=u.height;var z=u.width;var H;var L=g[this.img];var S=this.spriteWidth;var R=this.spriteHeight;var Q=this.width/2;var P=this.height/2;var A=L.width/S;var w=L.height/R;var U=this.width/S;var T=this.height/R;var F=(H%A)*S;var E=(~~(H/A)%w)*R;while(O<C){while(G<D){H=B[O][G];if(H>=0&&v>I+K*O&&I+K*(O+1)>0&&z>J+M*G&&J+M*(G+1)>0){var F=(H%A)*S;var E=(~~(H/A)%w)*R;N.save();N.translate(this.x,this.y);N.scale(U,T);N.drawImage(L,F,E,S,R,0,0,S,R);N.restore()}this.x+=M;G++}this.y+=K;O++;this.x=J;G=0}this.x=J;this.y=I}});var r=o.createClass(d,{initialize:function(w,v,x,u){this.inherit();this._basicConstructor="Text";this.x=0;this.y=0;this.scaleX=1;this.scaleY=1;this.alpha=1;this.spaceWidth=0;if(u){this.font="'"+u+"'"}else{this.font="'Meiryo'"}if(x){this.size=x+"px"}else{this.size="10px"}if(w){this.string=w}else{this.string=""}if(v){this.color=v}else{this.color="white"}},setSize:function(u){this.size=u+"px"},setFont:function(u){this.font="'"+u+"'"},intersect:function(D,B){var A=this.x;var z=this.y;var w=parseInt(this.size)*this.scaleX*this.string.length;var H=parseInt(this.size)*this.scaleY;var G=D-(A+w/2);var F=B-(z+H/2);var v=this.rot;var I=Math.sin(-v);var E=Math.cos(-v);var u=Math.abs(G*E-F*I);var C=Math.abs(G*I+F*E);if(u<w/2&&C<H/2){return true}return false},scale:function(u,v){this.scaleX*=u;this.scaleY*=v},_scaleBy:function(u){if(u.time==0){u.diffWidth=u.scaleX-this.scaleX;u.diffHeight=u.scaleY-this.scaleY}this.scaleX=u.scaleX-u.diffWidth*(1-u.time/u.frame);this.scaleY=u.scaleY-u.diffHeight*(1-u.time/u.frame)},draw:function(){var B=this.x;var A=this.y;var D=this.scaleX;var C=this.scaleY;var G=this.ctx;var E=this.string.split("<br>");var u=E.length;G.globalAlpha=this.alpha;G.globalCompositeOperation=this.drawMode;G.font=this.size+" "+this.font;var F=G.measureText("a").width*1.5+this.spaceWidth;G.fillStyle=this.color;G.save();var z=parseInt(this.size)*this.scaleX*this.string.length/2;var w=parseInt(this.size)*this.scaleY/2;G.translate(B+z,A+w);G.rotate(this.rot);G.translate(-z,-w);G.scale(D,C);for(var v=0;v<u;v++){G.fillText(E[v],0,F);A+=F}G.restore();G.globalAlpha=1}});var q=o.createClass(r,{initialize:function(A,y,u,w,v){this.inherit("",w,u-5,v);this.box=new o.Sprite(A);this.box.width=y;this.box.height=u;var x=document.createElement("input");x.style.position="absolute";x.style.zIndex=-1;x.parent=this;var z=document.getElementsByTagName("body").item(0);z.appendChild(x);this.element=x;x.addEventListener("input",function(){var D=this.parent;var B=D.ctx;var C=this.value;while(B.measureText(C).width>D.box.width){C=C.slice(1,C.length)}D.string=C})},onLoad:function(){this.element.style.top=this.field.style.top;this.element.style.left=this.field.style.left;this.element.style.marginTop=this.field.style.marginTop;this.element.style.marginLeft=this.field.style.marginLeft;var v=this.box;var u=v.getImage();v.setSpriteSize(u.width,u.height);v.field=this.field;v.ctx=this.ctx;v.setPosition(this.x,this.y);this.parent.addChild(v)},enterFrame:function(){var u=this.box;u.setPosition(this.x,this.y)},touchStart:function(u){if(this.box.intersect(u.x,u.y)){this.element.focus()}},getValue:function(){return this.element.value}});var m=o.createClass(n,{initialize:function(){this.inherit();this.children=[];this._basicConstructor="Group";for(var u=0,v=arguments.length;u<v;u++){this.children.push(arguments[u])}},draw:function(){var v=this.children;for(var u=0,x=v.length;u<x;u++){var w=v[u];w.x+=this.x;w.y+=this.y;if(w.useEvent){w.useEvent()}if(w.enterFrame){w.enterFrame()}if(w.tween){w.tween()}if(w.visible){w.draw()}if(w._remove){this.splice(u,1);w=null;u--;x--}w.x-=this.x;w.y-=this.y}},scale:function(u,B){var w=this.children;for(var v=0,A=arguments.length;v<A;v++){var z=w[v];if(z.scale){z.scale(u,B)}}},addChild:function(u){u.parent=this;this.children.push(u)},addChildren:function(){for(var u=0,v=arguments.length;u<v;u++){this.addChild(arguments[u])}},});window.Atlas=o;o.Util=d;o.Thing=n;o.App=p;o.Sprite=j;o.Shape=e;o.Map=c;o.Text=r;o.Scene=a;o.Input=q;o.Group=m})();